<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechWriterReview - Enterprise Document Analysis</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/features/portfolio.css">
    <link rel="stylesheet" href="/static/css/features/hyperlink-validator.css">
    <link rel="stylesheet" href="/static/css/features/hyperlink-enhanced.css">
    <link rel="stylesheet" href="/static/css/features/link-history.css">
    <!-- Vendor libraries: local first, CDN fallback for enterprise compatibility -->
    <script src="/static/js/vendor/lucide.min.js" onerror="loadCDNFallback('lucide')"></script>
    <script src="/static/js/vendor/chart.min.js" onerror="loadCDNFallback('chart')"></script>
    <script src="/static/js/vendor/d3.v7.min.js" defer onerror="loadCDNFallback('d3')"></script>
    <!-- v3.0.111: SortableJS for Statement Forge drag-and-drop -->
    <script src="https://unpkg.com/sortablejs@1.15.0/Sortable.min.js" defer></script>
    <script>
        // CDN fallback loader for enterprise networks without local vendor files
        function loadCDNFallback(lib) {
            const urls = {
                'lucide': 'https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js',
                'chart': 'https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js',
                'd3': 'https://d3js.org/d3.v7.min.js'
            };
            if (urls[lib]) {
                const s = document.createElement('script');
                s.src = urls[lib];
                if (lib === 'd3') s.defer = true;
                document.head.appendChild(s);
                console.log('[TechWriterReview] Loading ' + lib + ' from CDN fallback');
            }
        }
    </script>
</head>
<body>
<!-- v3.0.32: Top horizontal nav bar (Thread 9: Enterprise Polish) -->
<header class="top-nav-bar" id="top-nav-bar">
    <div class="top-nav-brand">
        <div class="top-nav-logo">
            <img src="/static/images/logo.svg" alt="TechWriterReview Logo" width="32" height="32" style="border-radius: 6px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div role="img" aria-label="TechWriterReview Logo" style="display:none; width:32px; height:32px; background:linear-gradient(135deg,#1e3a5f,#0d47a1); border-radius:6px; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:11px;">TWR</div>
        </div>
        <span class="top-nav-title">TechWriterReview</span>
    </div>
    
    <nav class="top-nav-links">
        <button class="top-nav-link active" data-view="review" id="nav-review" title="Review documents for issues" aria-label="Review documents for issues" aria-current="page">
            <i data-lucide="file-search" aria-hidden="true"></i>
            <span>Review</span>
        </button>
        <button class="top-nav-link" data-view="forge" id="nav-forge" title="Statement Forge - Extract requirements" aria-label="Statement Forge - Extract requirements">
            <i data-lucide="hammer" aria-hidden="true"></i>
            <span>Forge</span>
        </button>
        <button class="top-nav-link" data-view="roles" id="nav-roles" title="View detected roles and responsibilities" aria-label="View detected roles and responsibilities">
            <i data-lucide="users" aria-hidden="true"></i>
            <span>Roles</span>
        </button>
        <button class="top-nav-link" data-view="metrics" id="nav-metrics" title="View analysis metrics and charts" aria-label="View analysis metrics and charts">
            <i data-lucide="bar-chart-2" aria-hidden="true"></i>
            <span>Metrics</span>
        </button>
        <button class="top-nav-link" data-view="history" id="nav-history" title="View scan history" aria-label="View scan history">
            <i data-lucide="history" aria-hidden="true"></i>
            <span>History</span>
        </button>
        <button class="top-nav-link" id="nav-compare" title="Compare document versions" aria-label="Compare document versions">
            <i data-lucide="git-compare" aria-hidden="true"></i>
            <span>Compare</span>
        </button>
        <button class="top-nav-link" id="nav-hyperlink-validator" title="Validate hyperlinks" aria-label="Hyperlink Validator">
            <i data-lucide="link-2" aria-hidden="true"></i>
            <span>Validate</span>
        </button>
        <button class="top-nav-link" id="nav-portfolio" title="Portfolio tile view" aria-label="Portfolio tile view">
            <i data-lucide="layout-grid" aria-hidden="true"></i>
            <span>Portfolio</span>
        </button>
        <button class="top-nav-link" id="nav-link-history" title="Link exclusions & scan history" aria-label="Link History">
            <i data-lucide="link-2-off" aria-hidden="true"></i>
            <span>Links</span>
        </button>
    </nav>
    
    <div class="top-nav-actions">
        <!-- Run-state indicator -->
        <div class="run-state-indicator" id="run-state-indicator">
            <span class="run-state-icon" id="run-state-icon">
                <i data-lucide="circle" class="state-idle"></i>
            </span>
            <span class="run-state-label" id="run-state-label">Idle</span>
        </div>
        
        <!-- Quick actions -->
        <button class="top-nav-btn" id="btn-help-quick" title="Help & Documentation" aria-label="Help and Documentation">
            <i data-lucide="help-circle" aria-hidden="true"></i>
        </button>
        <button class="top-nav-btn" id="btn-settings-quick" title="Settings" aria-label="Open Settings">
            <i data-lucide="settings" aria-hidden="true"></i>
        </button>
    </div>
</header>

<div class="app-container">
    <!-- Enhanced Sidebar (v3.0.44: Collapsible) -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <span class="sidebar-version" id="version-label">Enterprise v3.0.115</span>
            </div>
            <button class="btn btn-ghost btn-xs sidebar-collapse-btn" id="btn-sidebar-collapse" title="Collapse sidebar (Ctrl+B)" aria-label="Collapse sidebar" aria-expanded="true">
                <i data-lucide="panel-left-close" aria-hidden="true"></i>
            </button>
        </div>

        <nav class="sidebar-nav">
            <!-- v3.0.114: Simplified Sidebar - Review Profile Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-label">Review Profile</div>
                <div class="profile-selector">
                    <button class="profile-btn active" id="btn-preset-reqs" title="Requirements-focused review">
                        <i data-lucide="file-check"></i>
                        <span>Requirements</span>
                    </button>
                    <button class="profile-btn" id="btn-preset-grammar" title="Grammar & spelling focus">
                        <i data-lucide="spell-check"></i>
                        <span>Grammar</span>
                    </button>
                    <button class="profile-btn" id="btn-preset-technical" title="Technical documentation">
                        <i data-lucide="file-cog"></i>
                        <span>Technical</span>
                    </button>
                    <button class="profile-btn" id="btn-preset-all" title="Enable all checks">
                        <i data-lucide="check-circle"></i>
                        <span>Full Scan</span>
                    </button>
                </div>
            </div>

            <!-- Document Type (optional) -->
            <div class="sidebar-section">
                <div class="sidebar-section-label">Document Type <span class="label-optional">(optional)</span></div>
                <div class="doc-type-selector">
                    <button class="doc-type-btn" id="btn-preset-prop" title="Procedure Operational">PrOP</button>
                    <button class="doc-type-btn" id="btn-preset-pal" title="Process Asset Library">PAL</button>
                    <button class="doc-type-btn" id="btn-preset-fgost" title="Flow Gate/Stage Gate">FGOST</button>
                    <button class="doc-type-btn" id="btn-preset-sow" title="Statement of Work">SOW</button>
                </div>
            </div>

            <!-- Severity Filter - Always visible -->
            <div class="sidebar-section">
                <div class="sidebar-section-label">Filter by Severity</div>
                <div class="severity-toggles">
                    <label class="severity-toggle" data-severity="critical">
                        <input type="checkbox" id="filter-critical" checked>
                        <span class="severity-pill critical">Critical <span class="sev-count" id="count-critical">0</span></span>
                    </label>
                    <label class="severity-toggle" data-severity="high">
                        <input type="checkbox" id="filter-high" checked>
                        <span class="severity-pill high">High <span class="sev-count" id="count-high">0</span></span>
                    </label>
                    <label class="severity-toggle" data-severity="medium">
                        <input type="checkbox" id="filter-medium" checked>
                        <span class="severity-pill medium">Medium <span class="sev-count" id="count-medium">0</span></span>
                    </label>
                    <label class="severity-toggle" data-severity="low">
                        <input type="checkbox" id="filter-low" checked>
                        <span class="severity-pill low">Low <span class="sev-count" id="count-low">0</span></span>
                    </label>
                    <label class="severity-toggle" data-severity="info">
                        <input type="checkbox" id="filter-info" checked>
                        <span class="severity-pill info">Info <span class="sev-count" id="count-info">0</span></span>
                    </label>
                </div>
            </div>

            <!-- Advanced Settings Toggle -->
            <div class="sidebar-section sidebar-advanced-toggle">
                <button class="btn btn-ghost btn-sm btn-full" id="btn-toggle-advanced" title="Show individual checker options">
                    <i data-lucide="sliders-horizontal"></i>
                    <span>Advanced Settings</span>
                    <i data-lucide="chevron-down" class="toggle-chevron"></i>
                </button>
            </div>

            <!-- Advanced Checkers Panel (hidden by default) -->
            <div class="sidebar-advanced-panel" id="advanced-panel" style="display: none;">
                <!-- Writing Quality -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-writing">
                        <span>Writing Quality</span>
                        <span class="checker-count" id="count-writing">7</span>
                    </div>
                    <div class="checker-list" id="checks-writing">
                        <label class="checker-item"><input type="checkbox" data-checker="passive_voice" checked><span>Passive Voice</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="weak_language" checked><span>Weak Language</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="wordy_phrases" checked><span>Wordy Phrases</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="nominalization" checked><span>Nominalization</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="jargon" checked><span>Jargon</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="sentence_length" checked><span>Long Sentences</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="repeated_words" checked><span>Repeated Words</span></label>
                    </div>
                </div>

                <!-- Grammar & Spelling -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-grammar">
                        <span>Grammar & Spelling</span>
                        <span class="checker-count" id="count-grammar">5</span>
                    </div>
                    <div class="checker-list" id="checks-grammar">
                        <label class="checker-item"><input type="checkbox" data-checker="spelling" checked><span>Spelling</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="grammar" checked><span>Grammar</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="punctuation" checked><span>Punctuation</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="capitalization" checked><span>Capitalization</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="contractions" checked><span>Contractions</span></label>
                    </div>
                </div>

                <!-- Technical Writing -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-technical">
                        <span>Technical Writing</span>
                        <span class="checker-count" id="count-technical">6</span>
                    </div>
                    <div class="checker-list" id="checks-technical">
                        <label class="checker-item"><input type="checkbox" data-checker="acronyms" checked><span>Undefined Acronyms</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="requirements_language" checked><span>Requirements Language</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="tbd" checked><span>TBD/TBR Placeholders</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="testability" checked><span>Testability</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="atomicity" checked><span>Atomicity</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="escape_clauses" checked><span>Escape Clauses</span></label>
                    </div>
                </div>

                <!-- Clarity -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-clarity">
                        <span>Clarity</span>
                        <span class="checker-count">5</span>
                    </div>
                    <div class="checker-list" id="checks-clarity">
                        <label class="checker-item"><input type="checkbox" data-checker="ambiguous_pronouns" checked><span>Ambiguous Pronouns</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="hedging" checked><span>Hedging</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="weasel_words" checked><span>Weasel Words</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="cliches" checked><span>Clichés</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="redundancy" checked><span>Redundancy</span></label>
                    </div>
                </div>

                <!-- Document Structure -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-structure">
                        <span>Document Structure</span>
                        <span class="checker-count">7</span>
                    </div>
                    <div class="checker-list" id="checks-structure">
                        <label class="checker-item"><input type="checkbox" data-checker="document_structure" checked><span>Document Structure</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="references" checked><span>References</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="hyperlinks" checked><span>Hyperlinks</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="tables_figures" checked><span>Tables & Figures</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="lists" checked><span>Lists</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="orphan_headings" checked><span>Orphan Headings</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="empty_sections" checked><span>Empty Sections</span></label>
                    </div>
                </div>

                <!-- Standards -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-standards">
                        <span>Standards Compliance</span>
                        <span class="checker-count">3</span>
                    </div>
                    <div class="checker-list" id="checks-standards">
                        <label class="checker-item"><input type="checkbox" data-checker="mil_std" checked><span>MIL-STD Compliance</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="do178" checked><span>DO-178C Compliance</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="accessibility" checked><span>Accessibility</span></label>
                    </div>
                </div>

                <!-- Other -->
                <div class="checker-category">
                    <div class="checker-category-header" data-target="checks-other">
                        <span>Other</span>
                        <span class="checker-count">4</span>
                    </div>
                    <div class="checker-list" id="checks-other">
                        <label class="checker-item"><input type="checkbox" data-checker="roles" checked><span>Role Extraction</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="gender_language" checked><span>Gender-Neutral</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="track_changes" checked><span>Track Changes</span></label>
                        <label class="checker-item"><input type="checkbox" data-checker="consistency" checked><span>Consistency</span></label>
                    </div>
                </div>

                <!-- Quick Actions for Advanced -->
                <div class="checker-actions">
                    <button class="btn btn-xs btn-ghost" id="btn-preset-none" title="Disable all checks">Clear All</button>
                    <button class="btn btn-xs btn-ghost" id="btn-save-profile" title="Save current settings">Save Profile</button>
                </div>
            </div>
        </nav>
        
        <!-- v3.0.49: Sidebar footer hidden - functionality moved to top nav bar -->
        <div class="sidebar-footer" style="display:none;">
            <!-- v3.0.33 Chunk C: Added statements-ready badge container -->
            <div class="btn-with-badge" style="position: relative; display: inline-block;">
                <button class="btn btn-ghost btn-sm" id="btn-statement-forge" title="Statement Forge" style="padding: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"></path><path d="M17.64 15 22 10.64"></path><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91"></path></svg>
                </button>
                <span class="sf-ready-badge" id="sf-ready-badge" style="display: none;" title="Statements extracted and ready">✓</span>
            </div>
            <button class="btn btn-ghost btn-sm" id="btn-scan-history" title="Scan History" style="padding: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            </button>
            <button class="btn btn-ghost btn-sm" id="btn-settings" title="Settings" style="padding: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            </button>
            <button class="btn btn-ghost btn-sm" id="btn-roles-report" title="Roles Report" disabled style="padding: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            </button>
            <button class="btn btn-ghost btn-sm" id="btn-diagnostics" title="Export Diagnostics (for troubleshooting)" style="padding: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M12 18v-6"></path><path d="M9 15h6"></path></svg>
            </button>
            <button class="btn btn-ghost btn-sm" id="btn-help" title="Help (F1)" style="padding: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><path d="M12 17h.01"></path></svg>
            </button>
            <div class="version-info" id="footer-version">v3.0.10</div>
        </div>
        <div class="sidebar-credit">Created by Nicholas Georgeson</div>
    </aside>
    
    <main class="main-content">
        <header class="main-header">
            <div class="doc-info">
                <div class="doc-status" id="doc-status">
                    <span class="doc-status-indicator" id="doc-status-indicator">
                        <i data-lucide="file-x"></i>
                    </span>
                    <span class="doc-status-text" id="doc-status-text">No document loaded</span>
                </div>
                <h1 class="doc-title" id="doc-title"></h1>
                <p class="doc-subtitle" id="doc-subtitle"></p>
            </div>
            <!-- v3.0.43: Persistent run-state indicator -->
            <div class="run-state-indicator" id="run-state-indicator" style="display:none;">
                <div class="run-state-pulse"></div>
                <span class="run-state-text" id="run-state-text">Scanning...</span>
                <button class="btn btn-ghost btn-xs run-state-cancel" id="run-state-cancel" title="Cancel scan">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="header-actions">
                <button class="btn btn-ghost btn-icon" id="btn-theme-toggle" title="Toggle dark/light mode">
                    <i data-lucide="sun" id="theme-icon-light" style="display:none;"></i>
                    <i data-lucide="moon" id="theme-icon-dark"></i>
                </button>
                <button class="btn btn-primary btn-action" id="btn-open" style="gap: 6px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><path d="M12 11v6"></path><path d="m9 14 3-3 3 3"></path></svg>
                    <span>Open</span>
                </button>
                <!-- v2.9.4.2: Batch Load button always visible (#19) -->
                <button class="btn btn-secondary btn-action" id="btn-batch-load" title="Load multiple documents" style="gap: 6px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 22h2a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M4 11l-2 2 2 2"></path><path d="M12 11l2 2-2 2"></path><path d="M5 16l3 6"></path><path d="M11 16l-3 6"></path></svg>
                    <span>Batch</span>
                </button>
                <button class="btn btn-secondary btn-action" id="btn-review" disabled style="gap: 6px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                    <span>Review</span>
                </button>
                <button class="btn btn-secondary btn-action" id="btn-export" disabled>
                    <i data-lucide="download"></i><span>Export</span>
                </button>
            </div>
        </header>
        
        <!-- Enhanced Stats Bar with Metrics -->
        <div class="stats-bar" id="stats-bar" style="display:none;">
            <div class="stat-group stat-group-document">
                <div class="stat">
                    <i data-lucide="file-text" class="stat-icon"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-words">0</span>
                        <span class="stat-label">Words</span>
                    </div>
                </div>
                <div class="stat">
                    <i data-lucide="align-justify" class="stat-icon"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-paragraphs">0</span>
                        <span class="stat-label">Paragraphs</span>
                    </div>
                </div>
                <div class="stat">
                    <i data-lucide="table" class="stat-icon"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-tables">0</span>
                        <span class="stat-label">Tables</span>
                    </div>
                </div>
                <div class="stat">
                    <i data-lucide="heading" class="stat-icon"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-headings">0</span>
                        <span class="stat-label">Headings</span>
                    </div>
                </div>
            </div>
            
            <div class="stat-divider"></div>
            
            <div class="stat-group stat-group-issues">
                <div class="stat stat-issues">
                    <i data-lucide="alert-triangle" class="stat-icon"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="stat-issues">--</span>
                        <span class="stat-label">Issues</span>
                    </div>
                </div>
                <div class="stat stat-score-container" id="stat-score-container" style="cursor: pointer;" title="Click to see score breakdown">
                    <div class="score-ring" id="score-ring">
                        <svg viewBox="0 0 36 36">
                            <path class="score-ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            <path class="score-ring-fill" id="score-ring-fill" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                        </svg>
                        <span class="score-value" id="stat-score">--</span>
                    </div>
                    <span class="stat-label">Score</span>
                </div>
                <div class="stat stat-grade-display">
                    <span class="stat-value grade" id="stat-grade">--</span>
                    <span class="stat-label">Grade</span>
                </div>
            </div>
            
            <div class="stat-divider"></div>
            
            <div class="stat-group stat-group-readability">
                <div class="stat tooltip-trigger" data-tooltip="Flesch Reading Ease Score (0-100). Higher = easier to read. 60-70: Standard/Plain English. 30-50: College level. 0-30: Graduate/professional level. Technical documents typically score 30-50.">
                    <div class="stat-content">
                        <span class="stat-value readability" id="stat-flesch">--</span>
                        <span class="stat-label">Flesch</span>
                    </div>
                </div>
                <div class="stat tooltip-trigger" data-tooltip="Flesch-Kincaid Grade Level. Indicates US school grade needed to understand text. 8-10: High school. 10-12: College. 12+: Graduate. Technical documents typically require grade 12+.">
                    <div class="stat-content">
                        <span class="stat-value readability" id="stat-fk-grade">--</span>
                        <span class="stat-label">Grade Level</span>
                    </div>
                </div>
                <div class="stat tooltip-trigger" data-tooltip="Gunning Fog Index. Years of formal education needed. 12: High school senior. 14: College sophomore. 17+: Graduate level. Higher values indicate more complex writing.">
                    <div class="stat-content">
                        <span class="stat-value readability" id="stat-fog">--</span>
                        <span class="stat-label">Fog Index</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="content-area">
            <!-- Empty State - Enterprise Design -->
            <div class="empty-state" id="empty-state">
                <div class="empty-icon" id="dropzone">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                </div>
                <h2>Drop a document to begin</h2>
                <p class="empty-subtitle">Drag & drop a .docx or .pdf file, or use <kbd>Ctrl</kbd>+<kbd>O</kbd> to open</p>
                <div class="empty-capabilities">
                    <span class="capability-item">50+ Quality Checks</span>
                    <span class="capability-divider">·</span>
                    <span class="capability-item">Role Extraction</span>
                    <span class="capability-divider">·</span>
                    <span class="capability-item">Readability Analysis</span>
                    <span class="capability-divider">·</span>
                    <span class="capability-item">Standards Compliance</span>
                </div>
            </div>
            
            <!-- Batch Upload Modal -->
            <div class="modal" id="batch-upload-modal">
                <div class="modal-overlay"></div>
                <div class="modal-container" style="max-width:700px;">
                    <div class="modal-header">
                        <h3><i data-lucide="folder-plus"></i> Batch Upload Documents</h3>
                        <button class="btn btn-ghost" id="btn-close-batch-modal">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="batch-dropzone" id="batch-dropzone">
                            <i data-lucide="upload-cloud"></i>
                            <p>Drop multiple .docx or .pdf files here</p>
                            <p class="text-muted">or click to select files</p>
                            <input type="file" id="batch-file-input" multiple accept=".docx,.pdf" style="display:none;">
                        </div>
                        <div class="batch-file-list" id="batch-file-list">
                            <!-- Files will be listed here -->
                        </div>
                        <div class="batch-progress" id="batch-progress" style="display:none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="batch-progress-fill"></div>
                            </div>
                            <span id="batch-progress-text">Processing...</span>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="btn-cancel-batch">Cancel</button>
                        <button class="btn btn-primary" id="btn-start-batch" disabled>
                            <i data-lucide="play"></i> Process All Files
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Batch Results View -->
            <div class="batch-results" id="batch-results" style="display:none;">
                <div class="batch-results-header">
                    <h3><i data-lucide="files"></i> Batch Scan Results</h3>
                    <button class="btn btn-secondary" id="btn-back-from-batch">
                        <i data-lucide="arrow-left"></i> Back
                    </button>
                </div>
                <div class="batch-summary" id="batch-summary">
                    <!-- Summary cards here -->
                </div>
                <div class="batch-documents" id="batch-documents">
                    <!-- Document list here -->
                </div>
            </div>
            
            <!-- Analytics Accordion (v3.0.13 - collapsed by default) -->
            <div class="analytics-accordion" id="analytics-accordion" style="display:none;">
                <div class="analytics-header" id="analytics-header">
                    <div class="analytics-summary">
                        <i data-lucide="bar-chart-2"></i>
                        <span class="analytics-title">Analytics</span>
                        <span class="analytics-inline-stats" id="analytics-inline-stats">
                            <!-- e.g., "5 Critical, 3 High, 12 Medium" - populated dynamically -->
                        </span>
                    </div>
                    <div class="analytics-actions">
                        <span class="analytics-toggle-hint" id="analytics-toggle-hint">Click to expand</span>
                        <i data-lucide="chevron-down" class="analytics-chevron" id="analytics-chevron"></i>
                    </div>
                </div>
                <div class="analytics-body" id="analytics-body" style="display:none;">
                    <!-- Chart Filter Notice -->
                    <div class="chart-filter-notice" id="chart-filter-notice" style="display:none;">
                        <i data-lucide="filter"></i>
                        <span>Filtered by chart: <strong id="chart-filter-value"></strong></span>
                        <button class="btn btn-xs btn-secondary" id="btn-clear-chart-filter">
                            <i data-lucide="x"></i> Clear
                        </button>
                    </div>
                    
                    <!-- Smart Recommendations Banner -->
                    <div class="smart-recommendations" id="smart-recommendations" style="display:none;">
                        <div class="recommendations-header">
                            <i data-lucide="lightbulb"></i>
                            <span>Smart Recommendations</span>
                            <button class="btn btn-ghost btn-xs" id="btn-dismiss-recommendations" title="Dismiss">
                                <i data-lucide="x"></i>
                            </button>
                        </div>
                        <div class="recommendations-body" id="recommendations-list">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                    
                    <!-- Mini Charts Row - v3.0.49: Severity/Category charts hidden, use heatmap instead -->
                    <div class="dashboard-charts">
                        <!-- v3.0.49: Severity chart hidden - heatmap provides this info -->
                        <div class="chart-card chart-clickable" data-chart="severity" style="display:none;">
                            <div class="chart-header">
                                <h4><i data-lucide="pie-chart"></i> Severity Distribution</h4>
                                <span class="chart-hint">Click to filter</span>
                            </div>
                            <div class="chart-body">
                                <canvas id="chart-severity" width="200" height="200"></canvas>
                            </div>
                        </div>
                        <!-- v3.0.49: Category chart hidden - heatmap provides this info -->
                        <div class="chart-card chart-clickable" data-chart="category" style="display:none;">
                            <div class="chart-header">
                                <h4><i data-lucide="bar-chart-3"></i> Top Categories</h4>
                                <span class="chart-hint">Click to filter</span>
                            </div>
                            <div class="chart-body">
                                <canvas id="chart-categories" width="300" height="200"></canvas>
                            </div>
                        </div>
                        <div class="chart-card chart-card-roles" id="roles-chart-card" style="display:none;">
                            <div class="chart-header">
                                <h4><i data-lucide="users"></i> Roles Detected</h4>
                                <button class="btn btn-ghost btn-sm" id="btn-view-roles" title="View Full Report">
                                    <i data-lucide="external-link"></i>
                                </button>
                            </div>
                            <div class="chart-body roles-summary" id="roles-summary">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                        <div class="chart-card chart-card-acronyms" id="acronym-metrics-card" style="display:none;">
                            <div class="chart-header">
                                <h4><i data-lucide="a-large-small"></i> Acronym Analysis</h4>
                                <div class="acronym-mode-badge" id="acronym-mode-badge" title="Click to toggle mode">
                                    <span id="acronym-mode-label">Strict Mode</span>
                                </div>
                            </div>
                            <div class="chart-body acronym-metrics" id="acronym-metrics">
                                <div class="acronym-metrics-grid">
                                    <div class="acronym-metric">
                                        <span class="metric-value" id="acronym-total-count">0</span>
                                        <span class="metric-label">Acronyms Found</span>
                                    </div>
                                    <div class="acronym-metric">
                                        <span class="metric-value" id="acronym-defined-count">0</span>
                                        <span class="metric-label">Defined</span>
                                    </div>
                                    <div class="acronym-metric">
                                        <span class="metric-value" id="acronym-suppressed-count">0</span>
                                        <span class="metric-label">Suppressed</span>
                                    </div>
                                    <div class="acronym-metric" style="background: var(--color-warning-light);">
                                        <span class="metric-value" id="acronym-flagged-count">0</span>
                                        <span class="metric-label">Flagged</span>
                                    </div>
                                </div>
                                <div class="acronym-suppressed-list" id="acronym-suppressed-list" style="display:none;">
                                    <small class="text-muted">Suppressed acronyms: <span id="acronym-suppressed-items">-</span></small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- v3.0.33 Chunk E: Score Trend Sparkline -->
                        <div class="chart-card chart-card-trend" id="score-trend-card" style="display:none;">
                            <div class="chart-header">
                                <h4><i data-lucide="trending-up"></i> Quality Score Trend</h4>
                                <span class="trend-summary" id="trend-summary">-</span>
                            </div>
                            <div class="chart-body sparkline-body" id="sparkline-container">
                                <svg id="score-sparkline" width="100%" height="60"></svg>
                                <div class="sparkline-tooltip" id="sparkline-tooltip" style="display:none;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- v3.0.114: Combined Document Analytics Panel (3 columns) -->
                    <div class="issue-analytics-combined" id="issue-analytics-combined" style="display:none;">
                        <div class="analytics-combined-header">
                            <h4><i data-lucide="bar-chart-3"></i> Document Analytics</h4>
                            <div class="heatmap-actions">
                                <button class="btn btn-ghost btn-xs" id="btn-export-heatmap" title="Export as PNG">
                                    <i data-lucide="download"></i>
                                    Export
                                </button>
                            </div>
                        </div>
                        <div class="analytics-combined-body three-columns">
                            <!-- Column 1: Category × Severity Heatmap -->
                            <div class="analytics-panel heatmap-panel">
                                <div class="panel-subtitle">Issues by Category</div>
                                <div class="heatmap-body" id="issue-heatmap">
                                    <!-- Populated dynamically by renderIssueHeatmap() -->
                                </div>
                                <div class="heatmap-legend heatmap-intensity-legend">
                                    <span class="legend-item"><span class="legend-color intensity-0"></span> 0</span>
                                    <span class="legend-item"><span class="legend-color intensity-1"></span> 1-2</span>
                                    <span class="legend-item"><span class="legend-color intensity-2"></span> 3-5</span>
                                    <span class="legend-item"><span class="legend-color intensity-3"></span> 6-10</span>
                                    <span class="legend-item"><span class="legend-color intensity-4"></span> 10+</span>
                                </div>
                            </div>
                            <!-- Column 2: Issue Density by Section -->
                            <div class="analytics-panel density-panel">
                                <div class="panel-subtitle">Issues by Section</div>
                                <div class="heatmap-body" id="section-heatmap">
                                    <!-- Populated dynamically -->
                                </div>
                                <div class="heatmap-legend density-legend">
                                    <span class="legend-item"><span class="legend-color low"></span> Low</span>
                                    <span class="legend-item"><span class="legend-color medium"></span> Medium</span>
                                    <span class="legend-item"><span class="legend-color high"></span> High</span>
                                </div>
                            </div>
                            <!-- Column 3: Hyperlink Status with Domain Health Carousel -->
                            <div class="analytics-panel hyperlinks-panel" id="hyperlinks-panel">
                                <div class="panel-subtitle">Hyperlinks</div>
                                <div class="hyperlinks-summary" id="hyperlink-summary-inline">
                                    <!-- Summary: 4 valid, 0 invalid -->
                                </div>
                                <!-- Domain Health Carousel (3D) for Review Tab -->
                                <div class="review-domain-carousel-container" id="review-domain-carousel" style="display:none;">
                                    <!-- Domain health carousel will be rendered here by HyperlinkVisualization -->
                                </div>
                                <div class="hyperlinks-list" id="hyperlink-list-inline">
                                    <!-- Populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Legacy containers for backward compatibility (hidden) -->
                    <div class="issue-heatmap-container" id="issue-heatmap-container" style="display:none !important;"></div>
                    <div class="section-heatmap-container" id="section-heatmap-container" style="display:none !important;"></div>
                    <div class="hyperlink-status-container" id="hyperlink-status-container" style="display:none !important;"></div>
                </div>
            </div>
            
            <!-- Unified Filter Bar (v3.0.13) -->
            <div class="unified-filter-bar" id="unified-filter-bar" style="display:none;">
                <div class="filter-bar-left">
                    <div class="severity-toggles" id="unified-severity-toggles">
                        <button class="sev-toggle active" data-severity="critical" title="Critical">
                            <span class="sev-dot critical"></span>
                            <span class="sev-label">Critical</span>
                            <span class="sev-count" id="unified-count-critical">0</span>
                        </button>
                        <button class="sev-toggle active" data-severity="high" title="High">
                            <span class="sev-dot high"></span>
                            <span class="sev-label">High</span>
                            <span class="sev-count" id="unified-count-high">0</span>
                        </button>
                        <button class="sev-toggle active" data-severity="medium" title="Medium">
                            <span class="sev-dot medium"></span>
                            <span class="sev-label">Medium</span>
                            <span class="sev-count" id="unified-count-medium">0</span>
                        </button>
                        <button class="sev-toggle active" data-severity="low" title="Low">
                            <span class="sev-dot low"></span>
                            <span class="sev-label">Low</span>
                            <span class="sev-count" id="unified-count-low">0</span>
                        </button>
                        <button class="sev-toggle active" data-severity="info" title="Info">
                            <span class="sev-dot info"></span>
                            <span class="sev-label">Info</span>
                            <span class="sev-count" id="unified-count-info">0</span>
                        </button>
                    </div>
                    <div class="filter-divider"></div>
                    <div class="category-dropdown">
                        <button class="btn btn-ghost btn-sm" id="btn-category-dropdown" title="Filter by category">
                            <i data-lucide="tag"></i>
                            <span>Categories</span>
                            <span class="category-active-count" id="category-active-count" style="display:none;">0</span>
                            <i data-lucide="chevron-down" style="width:12px;height:12px;"></i>
                        </button>
                        <div class="category-dropdown-panel" id="category-dropdown-panel" style="display:none;">
                            <div class="category-dropdown-header">
                                <input type="text" id="unified-category-search" class="form-input form-input-sm" placeholder="Search categories...">
                                <div class="category-quick-actions">
                                    <button class="btn btn-xs btn-ghost" id="unified-cat-all" title="Select All">All</button>
                                    <button class="btn btn-xs btn-ghost" id="unified-cat-none" title="Select None">None</button>
                                </div>
                            </div>
                            <div class="category-dropdown-list" id="unified-category-list">
                                <!-- Categories populated dynamically -->
                            </div>
                        </div>
                    </div>
                    <div class="filter-divider"></div>
                    <!-- v3.0.29: Validation filter toggle -->
                    <div class="validation-filter-toggle" id="validation-filter-toggle" title="Filter by source validation status">
                        <button class="btn btn-ghost btn-xs validation-btn active" data-validation="all" title="Show all issues">
                            <i data-lucide="list"></i>
                            <span>All</span>
                        </button>
                        <button class="btn btn-ghost btn-xs validation-btn" data-validation="validated" title="Show only validated issues">
                            <i data-lucide="check-circle"></i>
                            <span>Validated</span>
                            <span class="validation-count" id="validation-count-validated" style="display:none;">0</span>
                        </button>
                        <button class="btn btn-ghost btn-xs validation-btn" data-validation="unvalidated" title="Show unvalidated issues">
                            <i data-lucide="help-circle"></i>
                            <span>Unvalidated</span>
                            <span class="validation-count" id="validation-count-unvalidated" style="display:none;">0</span>
                        </button>
                    </div>
                </div>
                <div class="filter-bar-right">
                    <div class="filter-chips-inline" id="filter-chips-inline">
                        <!-- Active filter chips shown here -->
                    </div>
                    <button class="btn btn-ghost btn-xs" id="btn-clear-filters" title="Clear all filters" style="display:none;">
                        <i data-lucide="x"></i> Clear
                    </button>
                    <span class="filter-result-summary" id="filter-result-summary"></span>
                </div>
            </div>
            
            <!-- Issues Table -->
            <div class="table-container" id="issues-container" style="display:none;">
                <!-- Issue Families Panel (Pareto View) -->
                <div class="families-panel" id="families-panel" style="display:none;">
                    <div class="families-panel-header" id="families-panel-toggle">
                        <div class="families-panel-title">
                            <i data-lucide="layers"></i>
                            <span>Top Repeated Patterns</span>
                            <span class="families-panel-count" id="families-panel-count">0</span>
                        </div>
                        <div class="families-panel-actions">
                            <span class="families-panel-summary" id="families-panel-summary"></span>
                            <button class="btn btn-ghost btn-xs" id="btn-expand-families" title="Expand all details">
                                <i data-lucide="chevron-down"></i>
                            </button>
                        </div>
                    </div>
                    <div class="families-panel-body" id="families-panel-body">
                        <div class="families-inline-list" id="families-inline-list">
                            <!-- Populated dynamically -->
                        </div>
                        <div class="families-panel-footer">
                            <button class="btn btn-xs btn-ghost" id="btn-families-expand">
                                <i data-lucide="maximize-2"></i> View All in Modal
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="table-header">
                    <div class="table-actions">
                        <div class="selection-dropdown">
                            <button class="btn btn-ghost btn-sm" id="btn-select-menu" title="Selection options">
                                <i data-lucide="check-square"></i>
                                <i data-lucide="chevron-down" style="width:12px;height:12px;margin-left:2px;"></i>
                            </button>
                            <div class="dropdown-menu" id="select-dropdown" style="display:none;">
                                <button class="dropdown-item" id="btn-select-page">Select this page</button>
                                <button class="dropdown-item" id="btn-select-filtered">Select all filtered (<span id="filtered-total">0</span>)</button>
                                <button class="dropdown-item" id="btn-select-none-menu">Deselect all</button>
                            </div>
                        </div>
                        <span class="selection-count" id="selection-count">0 selected</span>
                        <span class="filtered-count" id="filtered-count"></span>
                    </div>
                    <div class="table-view-controls">
                        <button class="btn btn-ghost btn-sm" id="btn-triage-mode" title="Review issues one at a time (keyboard-first)">
                            <i data-lucide="list-checks"></i> Triage
                        </button>
                        <button class="btn btn-ghost btn-sm" id="btn-families" title="Find repeated patterns for bulk action">
                            <i data-lucide="copy"></i> Families
                        </button>
                        <button class="btn btn-ghost btn-sm" id="btn-review-log" title="View audit trail of decisions">
                            <i data-lucide="clipboard-list"></i> Log
                            <span class="review-log-badge" id="review-log-badge" style="display:none;">0</span>
                        </button>
                        <div class="density-toggle" title="Row density">
                            <button class="btn btn-ghost btn-xs density-btn active" data-density="compact" title="Compact">
                                <i data-lucide="align-justify"></i>
                            </button>
                            <button class="btn btn-ghost btn-xs density-btn" data-density="comfortable" title="Comfortable">
                                <i data-lucide="menu"></i>
                            </button>
                        </div>
                        <div class="table-view-toggle">
                            <button class="btn btn-ghost btn-sm active" id="btn-view-table" title="Table View">
                                <i data-lucide="list"></i>
                            </button>
                            <button class="btn btn-ghost btn-sm" id="btn-view-cards" title="Card View">
                                <i data-lucide="layout-grid"></i>
                            </button>
                        </div>
                    </div>
                    <div class="search-box">
                        <i data-lucide="search"></i>
                        <input type="text" id="issue-search" placeholder="Search issues..." aria-label="Search issues">
                        <button class="btn btn-ghost btn-xs" id="btn-clear-search" style="display:none;" aria-label="Clear search">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                
                <div class="issues-list-header" id="issues-list-header">
                    <div class="col-expand"></div>
                    <div class="col-check"></div>
                    <div class="col-severity sortable" data-sort="severity" tabindex="0" role="button" aria-label="Sort by severity">
                        Severity <i data-lucide="chevron-up" class="sort-icon"></i>
                    </div>
                    <div class="col-category sortable" data-sort="category" tabindex="0" role="button" aria-label="Sort by category">
                        Category <i data-lucide="chevron-up" class="sort-icon"></i>
                    </div>
                    <div class="col-message">Message</div>
                    <div class="col-actions"></div>
                </div>
                
                <div class="table-body" id="issues-list" role="list" aria-label="Issues list">
                    <!-- Issues populated here -->
                </div>
                
                <!-- Keyboard Navigation Hint -->
                <div class="keyboard-hint" id="keyboard-hint" style="display:none;">
                    <kbd>↑</kbd><kbd>↓</kbd> Navigate &nbsp; <kbd>Enter</kbd> Expand &nbsp; <kbd>Space</kbd> Select &nbsp; <kbd>Esc</kbd> Close
                </div>
                
                <!-- Pagination -->
                <div class="table-footer" id="table-footer" style="display:none;">
                    <div class="pagination-info">
                        Showing <span id="page-start">1</span>-<span id="page-end">50</span> of <span id="total-issues">0</span> issues
                    </div>
                    <div class="pagination-controls">
                        <button class="btn btn-ghost btn-sm" id="btn-prev-page" title="Previous page" disabled>
                            <i data-lucide="chevron-left"></i> Previous
                        </button>
                        <span class="page-indicator">Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
                        <button class="btn btn-ghost btn-sm" id="btn-next-page" title="Next page" disabled>
                            Next <i data-lucide="chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Hidden file input -->
<input type="file" id="file-input" style="display:none" accept=".docx,.pdf">

<!-- Toast container -->
<div class="toast-container" id="toast-container"></div>

<!-- Enhanced Loading overlay with 3D animated progress (B9) -->
<div class="loading-overlay" id="loading-overlay">
    <div class="loading-content loading-3d">
        <!-- Glowing orb accents -->
        <div class="loading-orb loading-orb-1"></div>
        <div class="loading-orb loading-orb-2"></div>
        <div class="loading-orb loading-orb-3"></div>

        <p id="loading-text" class="loading-title">Processing...</p>

        <!-- 3D Progress bar -->
        <div class="loading-progress-3d">
            <div class="loading-progress-bar-3d" id="loading-progress-bar"></div>
            <div class="loading-progress-shine"></div>
            <!-- Floating particles -->
            <div class="loading-particles">
                <div class="loading-particle orb" style="left: 10%; animation-delay: 0s;"></div>
                <div class="loading-particle orb" style="left: 25%; animation-delay: 0.5s;"></div>
                <div class="loading-particle orb" style="left: 40%; animation-delay: 1s;"></div>
                <div class="loading-particle orb" style="left: 55%; animation-delay: 1.5s;"></div>
                <div class="loading-particle orb" style="left: 70%; animation-delay: 2s;"></div>
                <div class="loading-particle orb" style="left: 85%; animation-delay: 0.3s;"></div>
                <div class="loading-particle sparkle" style="left: 15%; animation-delay: 0.2s;"></div>
                <div class="loading-particle sparkle" style="left: 35%; animation-delay: 0.7s;"></div>
                <div class="loading-particle sparkle" style="left: 50%; animation-delay: 1.2s;"></div>
                <div class="loading-particle sparkle" style="left: 65%; animation-delay: 0.4s;"></div>
                <div class="loading-particle sparkle" style="left: 80%; animation-delay: 0.9s;"></div>
                <div class="loading-particle sparkle" style="left: 95%; animation-delay: 1.6s;"></div>
            </div>
        </div>

        <!-- v2.9.4.2: Enhanced loading with ETA (#24) -->
        <div class="loading-eta-container" id="loading-eta-container" style="display:none;">
            <span class="loading-eta-label">Estimated time remaining:</span>
            <span class="loading-eta-value" id="loading-eta">calculating...</span>
        </div>
        <p class="loading-detail" id="loading-detail"></p>
        <!-- v2.9.4.2: Item counter for long operations -->
        <p class="loading-items" id="loading-items" style="display:none;"></p>
        <!-- Step-by-step progress checklist (B9) -->
        <div class="loading-steps" id="loading-steps" style="display:none;">
            <div class="loading-step" data-step="upload">
                <i data-lucide="circle" class="step-icon"></i>
                <span class="step-label">Uploading document...</span>
            </div>
            <div class="loading-step" data-step="extract">
                <i data-lucide="circle" class="step-icon"></i>
                <span class="step-label">Extracting text content...</span>
            </div>
            <div class="loading-step" data-step="analyze">
                <i data-lucide="circle" class="step-icon"></i>
                <span class="step-label">Running quality checks...</span>
            </div>
            <div class="loading-step" data-step="roles">
                <i data-lucide="circle" class="step-icon"></i>
                <span class="step-label">Detecting roles & responsibilities...</span>
            </div>
            <div class="loading-step" data-step="render">
                <i data-lucide="circle" class="step-icon"></i>
                <span class="step-label">Rendering results...</span>
            </div>
        </div>
        <!-- v2.9.4.2: Cancel button for long operations -->
        <button class="btn btn-ghost btn-sm loading-cancel" id="loading-cancel" style="display:none;">
            <i data-lucide="x"></i> Cancel
        </button>
    </div>
</div>

<!-- Triage Mode Modal -->
<div class="modal modal-lg" id="modal-triage" role="dialog" aria-modal="true" aria-labelledby="modal-triage-title">
    <div class="modal-content triage-modal">
        <div class="modal-header">
            <h3 id="modal-triage-title"><i data-lucide="list-checks"></i> Triage Mode</h3>
            <div class="triage-progress">
                <span id="triage-current">1</span> / <span id="triage-total">0</span>
                <div class="triage-progress-bar">
                    <div class="triage-progress-fill" id="triage-progress-fill" style="width:0%"></div>
                </div>
            </div>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body triage-body">
            <div class="triage-issue" id="triage-issue">
                <div class="triage-header">
                    <span class="severity-badge" id="triage-severity">Info</span>
                    <span class="triage-category" id="triage-category">Category</span>
                </div>
                <div class="triage-message" id="triage-message">
                    Issue message will appear here
                </div>
                <div class="triage-context" id="triage-context">
                    <h5>Context</h5>
                    <div class="context-text" id="triage-context-text">
                        Surrounding text context...
                    </div>
                </div>
                <div class="triage-suggestion" id="triage-suggestion-section">
                    <h5>Suggestion</h5>
                    <div class="suggestion-text" id="triage-suggestion-text">
                        Suggested fix...
                    </div>
                </div>
                <div class="triage-family-info" id="triage-family-info" style="display:none;"></div>
            </div>
        </div>
        <div class="modal-footer triage-footer">
            <div class="triage-nav">
                <button class="btn btn-ghost" id="btn-triage-prev" title="Previous issue (←)">
                    <i data-lucide="chevron-left"></i> Prev
                </button>
                <button class="btn btn-ghost" id="btn-triage-next" title="Next issue (→)">
                    Next <i data-lucide="chevron-right"></i>
                </button>
            </div>
            <div class="triage-actions">
                <button class="btn btn-success" id="btn-triage-keep" title="Keep this issue (K)">
                    <i data-lucide="check"></i> Keep
                </button>
                <button class="btn btn-warning" id="btn-triage-suppress" title="Suppress/baseline this issue (S)">
                    <i data-lucide="eye-off"></i> Suppress
                </button>
                <button class="btn btn-primary" id="btn-triage-fixed" title="Mark as fixed (F)">
                    <i data-lucide="check-circle"></i> Fixed
                </button>
            </div>
            <div class="triage-shortcuts">
                <kbd>←</kbd><kbd>→</kbd> Navigate &nbsp;
                <kbd>K</kbd> Keep &nbsp;
                <kbd>S</kbd> Suppress &nbsp;
                <kbd>F</kbd> Fixed &nbsp;
                <kbd>Esc</kbd> Exit
            </div>
        </div>
    </div>
</div>

<!-- Bulk Selection Confirmation Modal -->
<div class="modal modal-sm" id="modal-bulk-confirm" role="dialog" aria-modal="true" aria-labelledby="modal-bulk-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-bulk-title"><i data-lucide="alert-triangle"></i> Confirm Selection</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <p>You are about to select <strong id="bulk-count">0</strong> issues.</p>
            <p class="text-muted">This may affect performance with very large selections.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-primary" id="btn-confirm-bulk">Select All</button>
        </div>
    </div>
</div>

<!-- Export Modal -->
<div class="modal" id="modal-export" role="dialog" aria-modal="true" aria-labelledby="modal-export-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-export-title"><i data-lucide="download"></i> Export Document</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
        <div class="form-group">
            <label>Reviewer Name</label>
            <input type="text" id="export-reviewer-name" class="form-input" value="TechWriter Review" placeholder="Enter reviewer name">
        </div>
        <div class="form-group">
            <label>Export Mode</label>
            <div class="radio-group export-mode-group">
                <label class="radio-card">
                    <input type="radio" name="export-mode" value="all" checked>
                    <div class="radio-card-content">
                        <i data-lucide="file-text"></i>
                        <span class="radio-card-title">All Issues</span>
                        <span class="radio-card-count" id="export-count-all">0</span>
                    </div>
                </label>
                <label class="radio-card">
                    <input type="radio" name="export-mode" value="filtered">
                    <div class="radio-card-content">
                        <i data-lucide="filter"></i>
                        <span class="radio-card-title">Filtered</span>
                        <span class="radio-card-count" id="export-count-filtered">0</span>
                    </div>
                </label>
                <label class="radio-card">
                    <input type="radio" name="export-mode" value="selected">
                    <div class="radio-card-content">
                        <i data-lucide="check-square"></i>
                        <span class="radio-card-title">Selected</span>
                        <span class="radio-card-count" id="export-count-selected">0</span>
                    </div>
                </label>
            </div>
        </div>
        <div class="form-group">
            <label>Export Format</label>
            <div class="radio-group export-format-group">
                <label class="radio-card format-card" id="format-docx-card">
                    <input type="radio" name="export-format" value="docx" checked>
                    <div class="radio-card-content">
                        <i data-lucide="file-text"></i>
                        <span class="radio-card-title">Word Document</span>
                        <span class="radio-card-desc">.docx with comments</span>
                    </div>
                </label>
                <label class="radio-card format-card">
                    <input type="radio" name="export-format" value="csv">
                    <div class="radio-card-content">
                        <i data-lucide="file-spreadsheet"></i>
                        <span class="radio-card-title">CSV Spreadsheet</span>
                        <span class="radio-card-desc">.csv for Excel</span>
                    </div>
                </label>
                <label class="radio-card format-card">
                    <input type="radio" name="export-format" value="json">
                    <div class="radio-card-content">
                        <i data-lucide="braces"></i>
                        <span class="radio-card-title">JSON Data</span>
                        <span class="radio-card-desc">.json for analysis</span>
                    </div>
                </label>
            </div>
            <p class="help-text" id="export-pdf-notice" style="display:none; color: var(--warning);">
                Note: PDF files are read-only. Word export is only available for DOCX files.
            </p>
        </div>
        <!-- v3.0.111: Consolidated fix review section -->
        <div class="form-group" id="apply-fixes-group">
            <div class="fix-assistant-launcher" id="fix-assistant-launcher">
                <div class="fix-assistant-summary">
                    <div class="fix-summary-stat">
                        <i data-lucide="wand-2"></i>
                        <span id="fixable-count">0</span> fixes available
                    </div>
                    <div class="fix-summary-stat selected">
                        <i data-lucide="check-circle"></i>
                        <span id="selected-fix-count">0</span> selected
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" id="btn-open-fix-assistant" title="Review fixes before applying them to the document" onclick="if(window.FixAssistant){window.FixAssistant.open()}">
                    <i data-lucide="clipboard-check"></i> Review & Select Fixes
                </button>
            </div>
            <label class="checkbox-label checkbox-featured" style="margin-top: 0.75rem;">
                <input type="checkbox" id="export-apply-fixes">
                <span>
                    <strong>Apply selected fixes with Track Changes</strong>
                    <small>Selected fixes will be automatically applied to the exported document</small>
                </span>
            </label>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-secondary modal-close">Cancel</button>
        <button class="btn btn-primary" id="btn-do-export"><i data-lucide="download"></i> Export</button>
    </div>
    </div>
</div>

<!-- Export Review Modal (v2.9.4.2 #22) - Full-screen review before export -->
<div class="modal modal-fullscreen" id="modal-export-review" role="dialog" aria-modal="true" aria-labelledby="modal-export-review-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-export-review-title"><i data-lucide="clipboard-check"></i> Review Changes Before Export</h3>
            <div class="export-review-progress">
                <span id="export-review-progress-text">0 of 0 reviewed</span>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="export-review-progress-bar" style="width:0%"></div>
                </div>
            </div>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body export-review-body">
            <!-- Filter controls -->
            <div class="export-review-filters">
                <div class="filter-group">
                    <label>Severity:</label>
                    <select id="export-review-filter-severity" class="form-select">
                        <option value="">All</option>
                        <option value="Critical">Critical</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Category:</label>
                    <select id="export-review-filter-category" class="form-select">
                        <option value="">All</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Status:</label>
                    <select id="export-review-filter-status" class="form-select">
                        <option value="">All</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-sm btn-secondary" id="btn-approve-all-visible">
                        <i data-lucide="check-check"></i> Approve All Visible
                    </button>
                    <button class="btn btn-sm btn-secondary" id="btn-reject-all-visible">
                        <i data-lucide="x-circle"></i> Reject All Visible
                    </button>
                </div>
            </div>
            
            <!-- Issues list -->
            <div class="export-review-list" id="export-review-list">
                <!-- Populated dynamically -->
            </div>
        </div>
        <div class="modal-footer">
            <div class="export-review-summary">
                <span class="summary-item approved"><i data-lucide="check"></i> <span id="export-review-approved">0</span> approved</span>
                <span class="summary-item rejected"><i data-lucide="x"></i> <span id="export-review-rejected">0</span> rejected</span>
                <span class="summary-item pending"><i data-lucide="clock"></i> <span id="export-review-pending">0</span> pending</span>
            </div>
            <div class="export-review-actions">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn btn-primary" id="btn-export-approved">
                    <i data-lucide="download"></i> Export Approved (<span id="export-review-approved-count">0</span>)
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Fix Assistant Modal (v3.0.96) - Triage-style fix review -->
<!-- ═══════════════════════════════════════════════════════════════════════════ -->
<!-- Fix Assistant v2 Modal - v3.0.97                                            -->
<!-- Premium document review interface with two-panel layout                     -->
<!-- ═══════════════════════════════════════════════════════════════════════════ -->

<div class="fav2-modal" id="fav2-modal" role="dialog" aria-modal="true" aria-labelledby="fav2-modal-title" style="display: none;">
    <div class="fav2-modal-content">
        
        <!-- ═══════════════════════════════════════════════════════════════════ -->
        <!-- Header                                                               -->
        <!-- ═══════════════════════════════════════════════════════════════════ -->
        <header class="fav2-header">
            <div class="fav2-header-left">
                <!-- Title -->
                <h2 class="fav2-title" id="fav2-modal-title">
                    <i data-lucide="wand-2" aria-hidden="true"></i>
                    <span>Fix Assistant</span>
                </h2>
                
                <!-- Search -->
                <div class="fav2-search-wrapper">
                    <i data-lucide="search" class="fav2-search-icon" aria-hidden="true"></i>
                    <input 
                        type="text" 
                        id="fav2-search-input" 
                        class="fav2-search-input" 
                        placeholder="Search fixes..." 
                        aria-label="Search fixes"
                    >
                </div>
                
                <!-- Navigation Mode -->
                <div class="fav2-mode-wrapper">
                    <label for="fav2-nav-mode" class="visually-hidden">Navigation mode</label>
                    <select id="fav2-nav-mode" class="fav2-nav-mode" aria-label="Navigation mode">
                        <option value="all">All Fixes</option>
                        <option value="pending">Pending Only</option>
                        <option value="page">Current Page</option>
                        <option value="category">By Category</option>
                        <option value="confidence">By Confidence</option>
                    </select>
                </div>
            </div>
            
            <div class="fav2-header-center">
                <!-- Progress Bar -->
                <div class="fav2-progress-wrapper" role="progressbar" aria-valuenow="12" aria-valuemin="0" aria-valuemax="47" aria-label="Review progress">
                    <div class="fav2-progress-bar" id="fav2-progress-bar">
                        <div class="fav2-progress-fill" id="fav2-progress-fill" style="width: 25%;"></div>
                    </div>
                    <span class="fav2-progress-text" id="fav2-progress-text">
                        <span id="fav2-counter-current">12</span> of <span id="fav2-counter-total">47</span>
                    </span>
                </div>
            </div>
            
            <div class="fav2-header-right">
                <!-- Undo/Redo -->
                <div class="fav2-btn-group" role="group" aria-label="Undo and redo actions">
                    <button type="button" id="fav2-btn-undo" class="fav2-btn fav2-btn-icon" aria-label="Undo last action" title="Undo (U)" disabled>
                        <i data-lucide="undo-2" aria-hidden="true"></i>
                    </button>
                    <button type="button" id="fav2-btn-redo" class="fav2-btn fav2-btn-icon" aria-label="Redo last action" title="Redo (Shift+U)" disabled>
                        <i data-lucide="redo-2" aria-hidden="true"></i>
                    </button>
                </div>
                
                <!-- Shortcuts Toggle -->
                <button type="button" id="fav2-btn-shortcuts" class="fav2-btn fav2-btn-icon" aria-label="Toggle keyboard shortcuts" aria-pressed="false" title="Keyboard shortcuts (?)">
                    <i data-lucide="keyboard" aria-hidden="true"></i>
                </button>
                
                <!-- Sound Toggle -->
                <button type="button" id="fav2-btn-sound" class="fav2-btn fav2-btn-icon" aria-label="Toggle sound effects" aria-pressed="false" title="Sound effects (off)">
                    <i data-lucide="volume-x" aria-hidden="true"></i>
                </button>
                
                <!-- Close -->
                <button type="button" id="fav2-btn-close" class="fav2-btn fav2-btn-icon fav2-btn-close" aria-label="Close Fix Assistant" title="Close (Esc)">
                    <i data-lucide="x" aria-hidden="true"></i>
                </button>
            </div>
        </header>
        
        <!-- ═══════════════════════════════════════════════════════════════════ -->
        <!-- Body - Two Panel Layout                                              -->
        <!-- ═══════════════════════════════════════════════════════════════════ -->
        <main class="fav2-body">
            <div class="fav2-panels">
                
                <!-- Left Panel: Document Viewer -->
                <div class="fav2-panel-left">
                    <!-- Mini-map -->
                    <aside class="fav2-minimap-container" aria-label="Document minimap">
                        <div class="fav2-minimap" id="fav2-minimap" role="img" aria-label="Document overview with fix locations">
                            <!-- JS renders minimap content here -->
                            <div class="fav2-minimap-placeholder">
                                <span>Minimap</span>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Document Viewer -->
                    <section class="fav2-document-viewer-container">
                        <div class="fav2-document-viewer" id="fav2-document-viewer" tabindex="0" aria-label="Document preview with highlighted fixes" role="region">
                            <!-- JS renders document content here -->
                            <div class="fav2-viewer-placeholder">
                                <i data-lucide="file-text" aria-hidden="true"></i>
                                <span>Document content will appear here</span>
                            </div>
                        </div>
                    </section>
                </div>
                
                <!-- Right Panel: Fix Details -->
                <aside class="fav2-panel-right" aria-label="Fix details panel">
                    
                    <!-- Fix Header with Badges -->
                    <div class="fav2-fix-header">
                        <div class="fav2-fix-badges">
                            <span class="fav2-confidence-badge fav2-confidence-safe" id="fav2-confidence-badge" role="status">
                                SAFE
                            </span>
                            <span class="fav2-category-badge" id="fav2-category-badge">
                                Spelling
                            </span>
                        </div>
                        <div class="fav2-fix-counter" aria-label="Fix position">
                            <span class="fav2-counter-display">
                                <span id="fav2-counter-current-detail" aria-live="polite">1</span>
                                <span class="fav2-counter-separator">/</span>
                                <span id="fav2-counter-total-detail">47</span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Change Preview -->
                    <section class="fav2-change-section" aria-labelledby="fav2-change-heading">
                        <h3 class="visually-hidden" id="fav2-change-heading">Proposed Change</h3>
                        
                        <div class="fav2-change-row fav2-change-before">
                            <span class="fav2-change-label">Before:</span>
                            <span class="fav2-change-text" id="fav2-change-before" role="status" aria-live="polite">
                                recieve
                            </span>
                        </div>
                        
                        <div class="fav2-change-row fav2-change-after">
                            <span class="fav2-change-label">After:</span>
                            <span class="fav2-change-text" id="fav2-change-after" role="status" aria-live="polite">
                                receive
                            </span>
                        </div>
                    </section>
                    
                    <!-- Reason -->
                    <section class="fav2-reason-section" aria-labelledby="fav2-reason-heading">
                        <h3 class="visually-hidden" id="fav2-reason-heading">Reason for change</h3>
                        <div class="fav2-reason" id="fav2-reason" role="status" aria-live="polite">
                            Common spelling error: "i before e except after c"
                        </div>
                    </section>
                    
                    <!-- Confidence Details (Expandable) -->
                    <section class="fav2-confidence-section">
                        <button 
                            type="button" 
                            id="fav2-confidence-toggle" 
                            class="fav2-confidence-toggle" 
                            aria-expanded="false" 
                            aria-controls="fav2-confidence-details"
                        >
                            <i data-lucide="chevron-down" class="fav2-toggle-icon" aria-hidden="true"></i>
                            <span>Show confidence details</span>
                        </button>
                        <div class="fav2-confidence-details" id="fav2-confidence-details" hidden>
                            <dl class="fav2-confidence-list">
                                <dt>Confidence Score:</dt>
                                <dd><span class="fav2-confidence-score">95%</span></dd>
                                <dt>Category Certainty:</dt>
                                <dd>High</dd>
                                <dt>Pattern Match:</dt>
                                <dd>Dictionary lookup</dd>
                                <dt>Risk Level:</dt>
                                <dd>Minimal</dd>
                            </dl>
                        </div>
                    </section>
                    
                    <!-- Reviewer Note -->
                    <section class="fav2-note-section" aria-labelledby="fav2-note-heading">
                        <label for="fav2-reviewer-note" class="fav2-note-label" id="fav2-note-heading">
                            <i data-lucide="info" aria-hidden="true"></i>
                            Reviewer Note (optional):
                        </label>
                        <textarea 
                            id="fav2-reviewer-note" 
                            class="fav2-reviewer-note" 
                            placeholder="Add a note about this fix..."
                            rows="2"
                            aria-describedby="fav2-note-hint"
                        ></textarea>
                        <span class="fav2-note-hint visually-hidden" id="fav2-note-hint">
                            Optional note explaining your decision
                        </span>
                    </section>
                    
                    <!-- Page Fixes List -->
                    <section class="fav2-page-fixes-section" aria-labelledby="fav2-page-fixes-heading">
                        <h4 class="fav2-page-fixes-heading" id="fav2-page-fixes-heading">
                            Fixes on this page (<span class="fav2-page-fix-count">3</span>):
                        </h4>
                        <ul class="fav2-page-fixes-list" id="fav2-page-fixes-list" role="listbox" aria-label="Fixes on current page">
                            <!-- JS populates this list -->
                            <li class="fav2-page-fix-item fav2-page-fix-current" role="option" aria-selected="true" data-fix-index="0">
                                <span class="fav2-page-fix-text">recieve</span>
                                <span class="fav2-page-fix-status">(current)</span>
                            </li>
                            <li class="fav2-page-fix-item" role="option" aria-selected="false" data-fix-index="1">
                                <span class="fav2-page-fix-text">accomodate</span>
                            </li>
                            <li class="fav2-page-fix-item" role="option" aria-selected="false" data-fix-index="2">
                                <span class="fav2-page-fix-text">occured</span>
                            </li>
                        </ul>
                    </section>
                    
                    <!-- Action Buttons -->
                    <nav class="fav2-actions" aria-label="Fix actions">
                        <div class="fav2-action-primary">
                            <button type="button" id="fav2-btn-accept" class="fav2-btn fav2-btn-accept" title="Accept fix (A)">
                                <i data-lucide="check" aria-hidden="true"></i>
                                <span>Accept</span>
                            </button>
                            <button type="button" id="fav2-btn-reject" class="fav2-btn fav2-btn-reject" title="Reject fix (R)">
                                <i data-lucide="x" aria-hidden="true"></i>
                                <span>Reject</span>
                            </button>
                            <button type="button" id="fav2-btn-skip" class="fav2-btn fav2-btn-skip" title="Skip for now (S)">
                                <i data-lucide="skip-forward" aria-hidden="true"></i>
                                <span>Skip</span>
                            </button>
                        </div>
                        <div class="fav2-action-nav">
                            <button type="button" id="fav2-btn-prev" class="fav2-btn fav2-btn-nav" aria-label="Previous fix" title="Previous (←)">
                                <i data-lucide="chevron-left" aria-hidden="true"></i>
                                <span>Prev</span>
                            </button>
                            <button type="button" id="fav2-btn-next" class="fav2-btn fav2-btn-nav" aria-label="Next fix" title="Next (→)">
                                <span>Next</span>
                                <i data-lucide="chevron-right" aria-hidden="true"></i>
                            </button>
                        </div>
                    </nav>
                    
                </aside>
                
            </div>
            
            <!-- Split View Container (hidden by default) -->
            <div class="fav2-split-view" id="fav2-split-view" hidden aria-label="Split comparison view">
                <div class="fav2-split-original">
                    <h4>Original</h4>
                    <div class="fav2-split-content"></div>
                </div>
                <div class="fav2-split-modified">
                    <h4>With Changes</h4>
                    <div class="fav2-split-content"></div>
                </div>
            </div>
        </main>
        
        <!-- ═══════════════════════════════════════════════════════════════════ -->
        <!-- Footer                                                               -->
        <!-- ═══════════════════════════════════════════════════════════════════ -->
        <footer class="fav2-footer">
            <div class="fav2-footer-left">
                <!-- Statistics -->
                <div class="fav2-stats" role="status" aria-live="polite" aria-label="Review statistics">
                    <span class="fav2-stat fav2-stat-accepted" title="Accepted fixes">
                        <i data-lucide="check" aria-hidden="true"></i>
                        <span id="fav2-stat-accepted">28</span> accepted
                    </span>
                    <span class="fav2-stat fav2-stat-rejected" title="Rejected fixes">
                        <i data-lucide="x" aria-hidden="true"></i>
                        <span id="fav2-stat-rejected">8</span> rejected
                    </span>
                    <span class="fav2-stat fav2-stat-pending" title="Pending fixes">
                        <span class="fav2-stat-pending-icon">○</span>
                        <span id="fav2-stat-pending">11</span> pending
                    </span>
                </div>
            </div>
            
            <div class="fav2-footer-center">
                <!-- Bulk Actions -->
                <div class="fav2-bulk-actions" role="group" aria-label="Bulk actions">
                    <button type="button" id="fav2-btn-accept-safe" class="fav2-btn fav2-btn-bulk" title="Accept all high-confidence fixes">
                        <i data-lucide="shield-check" aria-hidden="true"></i>
                        <span>Safe</span>
                    </button>
                    <button type="button" id="fav2-btn-accept-all" class="fav2-btn fav2-btn-bulk" title="Accept all remaining fixes">
                        <i data-lucide="check-check" aria-hidden="true"></i>
                        <span>All</span>
                    </button>
                </div>
                
                <!-- View Mode Toggle -->
                <div class="fav2-view-toggle" role="group" aria-label="View mode">
                    <button type="button" id="fav2-btn-view-mode" class="fav2-btn fav2-btn-view" aria-pressed="false" title="Toggle split view">
                        <i data-lucide="eye" aria-hidden="true"></i>
                        <span>View</span>
                    </button>
                </div>
            </div>
            
            <div class="fav2-footer-right">
                <!-- Done Button -->
                <button type="button" id="fav2-btn-done" class="fav2-btn fav2-btn-done" title="Finish review and apply changes">
                    <span>Done</span>
                </button>
            </div>
        </footer>
        
    </div>
    
    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    <!-- Floating Panels                                                          -->
    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    
    <!-- Keyboard Shortcuts Panel -->
    <div class="fav2-shortcuts-panel" id="fav2-shortcuts-panel" role="complementary" aria-labelledby="fav2-shortcuts-title" hidden>
        <div class="fav2-shortcuts-header">
            <h3 id="fav2-shortcuts-title">
                <i data-lucide="keyboard" aria-hidden="true"></i>
                Keyboard Shortcuts
            </h3>
            <button type="button" class="fav2-shortcuts-close" aria-label="Close shortcuts panel">
                <i data-lucide="x" aria-hidden="true"></i>
            </button>
        </div>
        <div class="fav2-shortcuts-content">
            <table class="fav2-shortcuts-table" role="presentation">
                <thead class="visually-hidden">
                    <tr>
                        <th>Shortcut</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>A</kbd></td>
                        <td class="fav2-shortcut-action">Accept current fix</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>R</kbd></td>
                        <td class="fav2-shortcut-action">Reject current fix</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>S</kbd></td>
                        <td class="fav2-shortcut-action">Skip (decide later)</td>
                    </tr>
                    <tr class="fav2-shortcuts-divider"><td colspan="2"></td></tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>←</kbd> <kbd>→</kbd></td>
                        <td class="fav2-shortcut-action">Previous / Next fix</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>U</kbd></td>
                        <td class="fav2-shortcut-action">Undo last action</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>Shift</kbd>+<kbd>U</kbd></td>
                        <td class="fav2-shortcut-action">Redo</td>
                    </tr>
                    <tr class="fav2-shortcuts-divider"><td colspan="2"></td></tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>/</kbd></td>
                        <td class="fav2-shortcut-action">Focus search</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>G</kbd></td>
                        <td class="fav2-shortcut-action">Go to page...</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>?</kbd></td>
                        <td class="fav2-shortcut-action">Toggle this panel</td>
                    </tr>
                    <tr>
                        <td class="fav2-shortcut-key"><kbd>Esc</kbd></td>
                        <td class="fav2-shortcut-action">Close Fix Assistant</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
</div>

<!-- Settings Modal -->
<div class="modal modal-lg" id="modal-settings">
    <div class="modal-content">
        <div class="modal-header">
        <h3><i data-lucide="settings"></i> Settings</h3>
        <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
    </div>
    <div class="modal-body">
        <div class="settings-tabs">
            <button class="settings-tab active" data-tab="general">General</button>
            <button class="settings-tab" data-tab="review">Review Options</button>
            <button class="settings-tab" data-tab="profiles">Document Profiles</button>
            <button class="settings-tab" data-tab="sharing">Sharing</button>
            <button class="settings-tab" data-tab="display">Display</button>
            <button class="settings-tab" data-tab="updates">
                Updates
                <span class="update-badge" id="update-badge" style="display:none;">!</span>
            </button>
            <button class="settings-tab" data-tab="troubleshoot">
                <i data-lucide="bug" style="width: 14px; height: 14px; margin-right: 4px;"></i>
                Troubleshooting
            </button>
        </div>
        
        <div class="settings-content" id="settings-general">
            <div class="form-group">
                <label>Default Reviewer Name</label>
                <input type="text" id="settings-reviewer" class="form-input" placeholder="Enter default reviewer name">
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="settings-auto-review">
                    <span>Auto-review on file load</span>
                </label>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="settings-remember-checks" checked>
                    <span>Remember checker selections</span>
                </label>
            </div>
            <div class="form-group" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-default);">
                <label>Diagnostics Support Email</label>
                <input type="email" id="settings-diagnostics-email" class="form-input" placeholder="support@example.com" value="Nicholas.georgeson@gmail.com">
                <p class="help-text">Email address for sending diagnostic reports via Outlook</p>
            </div>
        </div>
        
        <div class="settings-content" id="settings-review" style="display:none;">
            <div class="form-group">
                <label>Max Sentence Length (words)</label>
                <input type="number" id="settings-max-sentence" class="form-input" value="40" min="20" max="100">
                <p class="help-text">Sentences exceeding this length will be flagged</p>
            </div>
            <div class="form-group">
                <label>Passive Voice Threshold</label>
                <select id="settings-passive-threshold" class="form-input">
                    <option value="strict">Strict - Flag all passive voice</option>
                    <option value="moderate" selected>Moderate - Allow some passive</option>
                    <option value="lenient">Lenient - Only flag excessive use</option>
                </select>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="settings-extract-roles" checked>
                    <span>Extract roles and responsibilities</span>
                </label>
            </div>

            <!-- Hyperlink Validation Settings (v3.0.109, enhanced v3.0.123) -->
            <div class="form-group" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-default);">
                <label><i data-lucide="link" style="width: 14px; height: 14px; margin-right: 4px;"></i> Hyperlink Validation</label>
                <select id="settings-hyperlink-mode" class="form-input">
                    <option value="offline">Offline — Format validation only (no network access)</option>
                    <option value="validator">Validator — Full HTTP check with authentication</option>
                </select>
                <p class="help-text">Validator mode supports Windows SSO, CAC/PIV certificates, and proxy servers. Optimized for .mil/.gov sites.</p>

                <!-- Advanced Authentication Settings (collapsible) -->
                <details id="hyperlink-auth-settings" style="margin-top: 12px;">
                    <summary style="cursor: pointer; font-size: 13px; color: var(--text-secondary);">
                        <i data-lucide="shield" style="width: 14px; height: 14px; margin-right: 4px;"></i>
                        Advanced Authentication Settings
                    </summary>
                    <div style="margin-top: 12px; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius-sm);">

                        <!-- CAC/PIV Certificate Authentication -->
                        <div style="margin-bottom: 12px;">
                            <label style="font-size: 12px; font-weight: 500;"><i data-lucide="key" style="width: 12px; height: 12px; margin-right: 4px;"></i> Client Certificate (CAC/PIV)</label>
                            <input type="text" id="settings-client-cert" class="form-input" placeholder="Path to certificate file (.pem)" style="font-size: 12px; margin-top: 4px;">
                            <input type="text" id="settings-client-key" class="form-input" placeholder="Path to private key file (.pem)" style="font-size: 12px; margin-top: 4px;">
                            <p class="help-text" style="font-size: 11px;">For CAC/PIV authentication to .mil sites. Leave blank for Windows SSO only.</p>
                        </div>

                        <!-- Custom CA Bundle -->
                        <div style="margin-bottom: 12px;">
                            <label style="font-size: 12px; font-weight: 500;"><i data-lucide="file-lock" style="width: 12px; height: 12px; margin-right: 4px;"></i> CA Certificate Bundle</label>
                            <input type="text" id="settings-ca-bundle" class="form-input" placeholder="Path to CA bundle (.crt or .pem)" style="font-size: 12px; margin-top: 4px;">
                            <p class="help-text" style="font-size: 11px;">DoD/Federal PKI root CA bundle for government site validation.</p>
                        </div>

                        <!-- Proxy Server -->
                        <div style="margin-bottom: 12px;">
                            <label style="font-size: 12px; font-weight: 500;"><i data-lucide="globe" style="width: 12px; height: 12px; margin-right: 4px;"></i> Proxy Server</label>
                            <input type="text" id="settings-proxy-url" class="form-input" placeholder="http://proxy.corp.mil:8080" style="font-size: 12px; margin-top: 4px;">
                            <p class="help-text" style="font-size: 11px;">Enterprise proxy server for network-restricted environments.</p>
                        </div>

                        <!-- SSL Verification -->
                        <div>
                            <label class="checkbox-label" style="font-size: 12px;">
                                <input type="checkbox" id="settings-verify-ssl" checked>
                                <span>Verify SSL certificates</span>
                            </label>
                            <p class="help-text" style="font-size: 11px;">Disable only for testing with self-signed certificates.</p>
                        </div>
                    </div>
                </details>

                <div class="hyperlink-mode-status" id="hyperlink-mode-status" style="display:none; margin-top: 8px; padding: 8px; border-radius: var(--radius-sm); font-size: 12px;">
                    <i data-lucide="info" style="width: 14px; height: 14px; margin-right: 4px;"></i>
                    <span id="hyperlink-mode-status-text"></span>
                </div>
            </div>
        </div>

        <!-- Document Profiles Tab (v3.0.110) -->
        <div class="settings-content" id="settings-profiles" style="display:none;">
            <div class="profiles-header">
                <h4><i data-lucide="file-check"></i> Document Type Profiles</h4>
                <p class="help-text">Customize which checks are performed for each document type. These settings persist across sessions.</p>
            </div>

            <!-- Profile Selector -->
            <div class="form-group">
                <label>Select Profile to Configure</label>
                <div class="profile-selector-settings">
                    <button class="profile-btn-settings active" data-profile="prop">PrOP</button>
                    <button class="profile-btn-settings" data-profile="pal">PAL</button>
                    <button class="profile-btn-settings" data-profile="fgost">FGOST</button>
                    <button class="profile-btn-settings" data-profile="sow">SOW</button>
                </div>
            </div>

            <!-- Profile Description -->
            <div class="profile-description" id="profile-description">
                <strong>PrOP (Procedure Operational)</strong> - Focus on process clarity and step-by-step instructions.
            </div>

            <!-- Checker Selection Grid -->
            <div class="checker-grid-container">
                <div class="checker-grid-header">
                    <span>Available Checks</span>
                    <div class="checker-grid-actions">
                        <button class="btn btn-ghost btn-xs" id="btn-profile-select-all">Select All</button>
                        <button class="btn btn-ghost btn-xs" id="btn-profile-clear-all">Clear All</button>
                        <button class="btn btn-ghost btn-xs" id="btn-profile-reset-default">Reset to Default</button>
                    </div>
                </div>

                <div class="checker-grid" id="profile-checker-grid">
                    <!-- Writing Quality -->
                    <div class="checker-category">
                        <div class="checker-category-header">Writing Quality</div>
                        <label class="checker-option"><input type="checkbox" data-check="passive_voice"> Passive Voice</label>
                        <label class="checker-option"><input type="checkbox" data-check="weak_language"> Weak Language</label>
                        <label class="checker-option"><input type="checkbox" data-check="wordy_phrases"> Wordy Phrases</label>
                        <label class="checker-option"><input type="checkbox" data-check="nominalization"> Nominalization</label>
                        <label class="checker-option"><input type="checkbox" data-check="jargon"> Jargon</label>
                        <label class="checker-option"><input type="checkbox" data-check="sentence_length"> Sentence Length</label>
                        <label class="checker-option"><input type="checkbox" data-check="repeated_words"> Repeated Words</label>
                    </div>

                    <!-- Grammar & Spelling -->
                    <div class="checker-category">
                        <div class="checker-category-header">Grammar & Spelling</div>
                        <label class="checker-option"><input type="checkbox" data-check="spelling"> Spelling</label>
                        <label class="checker-option"><input type="checkbox" data-check="grammar"> Grammar</label>
                        <label class="checker-option"><input type="checkbox" data-check="punctuation"> Punctuation</label>
                        <label class="checker-option"><input type="checkbox" data-check="capitalization"> Capitalization</label>
                        <label class="checker-option"><input type="checkbox" data-check="contractions"> Contractions</label>
                    </div>

                    <!-- Technical Writing -->
                    <div class="checker-category">
                        <div class="checker-category-header">Technical Writing</div>
                        <label class="checker-option"><input type="checkbox" data-check="acronyms"> Acronyms</label>
                        <label class="checker-option"><input type="checkbox" data-check="requirements_language"> Requirements Language</label>
                        <label class="checker-option"><input type="checkbox" data-check="tbd"> TBD/TBR Items</label>
                        <label class="checker-option"><input type="checkbox" data-check="testability"> Testability</label>
                        <label class="checker-option"><input type="checkbox" data-check="atomicity"> Atomicity</label>
                        <label class="checker-option"><input type="checkbox" data-check="escape_clauses"> Escape Clauses</label>
                    </div>

                    <!-- Clarity -->
                    <div class="checker-category">
                        <div class="checker-category-header">Clarity</div>
                        <label class="checker-option"><input type="checkbox" data-check="ambiguous_pronouns"> Ambiguous Pronouns</label>
                        <label class="checker-option"><input type="checkbox" data-check="hedging"> Hedging</label>
                        <label class="checker-option"><input type="checkbox" data-check="weasel_words"> Weasel Words</label>
                        <label class="checker-option"><input type="checkbox" data-check="cliches"> Cliches</label>
                        <label class="checker-option"><input type="checkbox" data-check="redundancy"> Redundancy</label>
                    </div>

                    <!-- Document Structure -->
                    <div class="checker-category">
                        <div class="checker-category-header">Document Structure</div>
                        <label class="checker-option"><input type="checkbox" data-check="document_structure"> Document Structure</label>
                        <label class="checker-option"><input type="checkbox" data-check="references"> References</label>
                        <label class="checker-option"><input type="checkbox" data-check="hyperlinks"> Hyperlinks</label>
                        <label class="checker-option"><input type="checkbox" data-check="tables_figures"> Tables & Figures</label>
                        <label class="checker-option"><input type="checkbox" data-check="lists"> Lists</label>
                        <label class="checker-option"><input type="checkbox" data-check="orphan_headings"> Orphan Headings</label>
                        <label class="checker-option"><input type="checkbox" data-check="empty_sections"> Empty Sections</label>
                    </div>

                    <!-- Standards & Other -->
                    <div class="checker-category">
                        <div class="checker-category-header">Standards & Other</div>
                        <label class="checker-option"><input type="checkbox" data-check="mil_std"> MIL-STD</label>
                        <label class="checker-option"><input type="checkbox" data-check="do178"> DO-178</label>
                        <label class="checker-option"><input type="checkbox" data-check="accessibility"> Accessibility</label>
                        <label class="checker-option"><input type="checkbox" data-check="roles"> Roles</label>
                        <label class="checker-option"><input type="checkbox" data-check="gender_language"> Gender Language</label>
                        <label class="checker-option"><input type="checkbox" data-check="units"> Units</label>
                        <label class="checker-option"><input type="checkbox" data-check="terminology"> Terminology</label>
                        <label class="checker-option"><input type="checkbox" data-check="consistency"> Consistency</label>
                    </div>
                </div>
            </div>

            <!-- Save Status -->
            <div class="profile-save-status" id="profile-save-status" style="display: none;">
                <i data-lucide="check-circle"></i>
                <span>Profile saved</span>
            </div>
        </div>

        <!-- Sharing Tab -->
        <div class="settings-content" id="settings-sharing" style="display:none;">
            <div class="sharing-settings-header">
                <h4><i data-lucide="share-2"></i> Role Dictionary Sharing</h4>
                <p class="help-text">Configure where your team's shared role dictionary is stored</p>
            </div>
            
            <div class="form-group">
                <label>Dictionary Location</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="dict-location" id="dict-location-local" value="local" checked>
                        <span>Local (app folder only)</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="dict-location" id="dict-location-shared" value="shared">
                        <span>Shared Drive / Network Folder</span>
                    </label>
                </div>
            </div>
            
            <div class="form-group shared-path-group" id="shared-path-group" style="display:none;">
                <label for="settings-shared-path">Shared Folder Path</label>
                <div class="input-with-button">
                    <input type="text" id="settings-shared-path" class="form-input" 
                           placeholder="\\\\server\\share\\twr or S:\\Team\\TechWriter">
                    <button class="btn btn-secondary" id="btn-browse-shared" title="Browse...">
                        <i data-lucide="folder"></i>
                    </button>
                    <button class="btn btn-secondary" id="btn-test-shared" title="Test Connection">
                        <i data-lucide="wifi"></i>
                    </button>
                </div>
                <p class="help-text">Enter a UNC path (\\\\server\\share) or mapped drive path (S:\\folder)</p>
                <div class="path-status" id="shared-path-status" style="display:none;">
                    <i data-lucide="check-circle"></i>
                    <span id="shared-path-status-text">Connection status will appear here</span>
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-default);">
                <label>Current Status</label>
                <div class="sharing-status-panel" id="settings-sharing-status">
                    <div class="status-row">
                        <span class="status-label">Local Database:</span>
                        <span class="status-value" id="status-local-db">Checking...</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Master File:</span>
                        <span class="status-value" id="status-master-file">Checking...</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Shared Location:</span>
                        <span class="status-value" id="status-shared-location">Not configured</span>
                    </div>
                </div>
            </div>
            
            <div class="sharing-help" style="margin-top: 16px; padding: 12px; background: var(--bg-surface); border-radius: var(--radius-md);">
                <h5 style="margin-bottom: 8px;"><i data-lucide="info"></i> How Team Sharing Works</h5>
                <ol style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-secondary);">
                    <li><strong>Local mode:</strong> Dictionary stored in your app folder only</li>
                    <li><strong>Shared mode:</strong> Dictionary syncs from a network location</li>
                    <li>All team members should point to the same shared folder</li>
                    <li>Use "Sync" in the Dictionary tab to pull updates from shared location</li>
                    <li>Use "Share" to export your dictionary for others to import</li>
                </ol>
            </div>
        </div>
        
        <div class="settings-content" id="settings-display" style="display:none;">
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="settings-essentials-mode">
                    <span>Essentials mode (hide advanced features)</span>
                </label>
                <p class="help-text">Hides Statement Forge, Roles, Triage, Families, and Analytics for a simpler interface.</p>
            </div>
            <div class="form-group">
                <label>Issues Per Page</label>
                <select id="settings-page-size" class="form-input">
                    <option value="25">25</option>
                    <option value="50" selected>50</option>
                    <option value="100">100</option>
                    <option value="all">All (no pagination)</option>
                </select>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="settings-show-charts">
                    <span>Expand analytics by default</span>
                </label>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="settings-compact-mode">
                    <span>Compact mode (denser issue list)</span>
                </label>
            </div>
        </div>
        
        <!-- Updates Tab -->
        <div class="settings-content" id="settings-updates" style="display:none;">
            <div class="update-status-panel">
                <div class="update-status-header">
                    <h4><i data-lucide="download-cloud"></i> Update Status</h4>
                    <button class="btn btn-sm btn-secondary" id="btn-check-updates">
                        <i data-lucide="refresh-cw"></i> Check for Updates
                    </button>
                </div>
                
                <div id="update-status-content">
                    <div class="update-checking" id="update-checking" style="display:none;">
                        <div class="spinner-small"></div>
                        <span>Checking for updates...</span>
                    </div>
                    
                    <div class="no-updates" id="no-updates">
                        <i data-lucide="check-circle"></i>
                        <p>No updates available</p>
                        <p class="help-text">Place update files in the "updates" folder to apply them.</p>
                    </div>
                    
                    <div class="updates-available" id="updates-available" style="display:none;">
                        <div class="update-summary">
                            <span class="update-count" id="update-count">0</span> update(s) available
                        </div>
                        <div class="update-list" id="update-list"></div>
                        <div class="update-actions">
                            <label class="checkbox-label">
                                <input type="checkbox" id="update-create-backup" checked>
                                <span>Create backup before updating</span>
                            </label>
                            <button class="btn btn-primary" id="btn-apply-updates">
                                <i data-lucide="download"></i> Apply Updates
                            </button>
                        </div>
                    </div>
                    
                    <div class="update-result" id="update-result" style="display:none;">
                        <div class="result-icon"></div>
                        <div class="result-message"></div>
                    </div>
                </div>
            </div>
            
            <div class="backup-panel" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-default);">
                <h4><i data-lucide="archive"></i> Backups</h4>
                <div class="backup-list" id="backup-list">
                    <p class="help-text">Loading backups...</p>
                </div>
                <div class="backup-actions" style="margin-top: 12px;">
                    <button class="btn btn-sm btn-secondary" id="btn-load-backups">
                        <i data-lucide="refresh-cw"></i> Refresh
                    </button>
                    <button class="btn btn-sm btn-warning" id="btn-rollback" disabled>
                        <i data-lucide="rotate-ccw"></i> Rollback to Latest
                    </button>
                </div>
            </div>
            
            <div class="update-help" style="margin-top: 20px; padding: 12px; background: var(--bg-surface); border-radius: var(--radius-md);">
                <h5 style="margin-bottom: 8px;">How to Update</h5>
                <ol style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-secondary);">
                    <li>Extract update package to the <code>updates</code> folder</li>
                    <li>Click "Check for Updates" above</li>
                    <li>Review the changes and click "Apply Updates"</li>
                    <li>Server will restart automatically and refresh your browser</li>
                </ol>
            </div>
        </div>

        <!-- Troubleshooting Tab (v3.0.114) -->
        <div class="settings-content" id="settings-troubleshoot" style="display:none;">
            <div class="troubleshoot-header" style="margin-bottom: 20px;">
                <h4 style="margin: 0 0 8px 0;"><i data-lucide="bug"></i> Diagnostic Export</h4>
                <p class="help-text" style="margin: 0;">Export diagnostic data to help identify and resolve issues. All sensitive information is automatically sanitized.</p>
            </div>

            <!-- Diagnostic Summary -->
            <div class="diagnostic-summary" id="diagnostic-summary" style="margin-bottom: 16px; padding: 12px; background: var(--bg-surface); border-radius: var(--radius-md);">
                <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <i data-lucide="alert-circle" style="width: 16px; height: 16px; color: var(--error);"></i>
                        <span><strong>Errors:</strong> <span id="diag-error-count">0</span></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <i data-lucide="alert-triangle" style="width: 16px; height: 16px; color: var(--warning);"></i>
                        <span><strong>Warnings:</strong> <span id="diag-warning-count">0</span></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <i data-lucide="activity" style="width: 16px; height: 16px; color: var(--text-secondary);"></i>
                        <span><strong>Requests:</strong> <span id="diag-request-count">0</span></span>
                    </div>
                </div>
            </div>

            <!-- Export Actions -->
            <div class="diagnostic-actions" style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                <button class="btn btn-secondary" id="btn-diag-refresh" title="Refresh diagnostic summary">
                    <i data-lucide="refresh-cw"></i> Refresh Stats
                </button>
                <button class="btn btn-primary" id="btn-diag-export-json" title="Export diagnostics as JSON for troubleshooting">
                    <i data-lucide="download"></i> Export JSON
                </button>
                <button class="btn btn-secondary" id="btn-diag-export-txt" title="Export diagnostics as readable text">
                    <i data-lucide="file-text"></i> Export Text Report
                </button>
            </div>

            <!-- What's Included -->
            <div class="diagnostic-info" style="padding: 16px; background: var(--bg-surface); border-radius: var(--radius-md); margin-bottom: 16px;">
                <h5 style="margin: 0 0 12px 0; font-size: 14px;">What's Included in Exports</h5>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; font-size: 13px;">
                    <div>
                        <strong style="color: var(--text-primary);">System Information</strong>
                        <ul style="margin: 4px 0 0 0; padding-left: 20px; color: var(--text-secondary);">
                            <li>Application version</li>
                            <li>Python version</li>
                            <li>Platform details</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: var(--text-primary);">Error Tracking</strong>
                        <ul style="margin: 4px 0 0 0; padding-left: 20px; color: var(--text-secondary);">
                            <li>Recent errors</li>
                            <li>Stack traces</li>
                            <li>Request logs</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: var(--text-primary);">Module Status</strong>
                        <ul style="margin: 4px 0 0 0; padding-left: 20px; color: var(--text-secondary);">
                            <li>Installed packages</li>
                            <li>Feature availability</li>
                            <li>Database state</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: var(--text-primary);">Browser Logs</strong>
                        <ul style="margin: 4px 0 0 0; padding-left: 20px; color: var(--text-secondary);">
                            <li>Console messages</li>
                            <li>JavaScript errors</li>
                            <li>Network requests</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Privacy Notice -->
            <div class="diagnostic-privacy" style="padding: 12px; background: var(--success-bg, #ecfdf5); border: 1px solid var(--success-border, #10b98133); border-radius: var(--radius-md);">
                <div style="display: flex; align-items: flex-start; gap: 10px;">
                    <i data-lucide="shield-check" style="width: 20px; height: 20px; color: var(--success); flex-shrink: 0; margin-top: 2px;"></i>
                    <div>
                        <strong style="color: var(--success); font-size: 13px;">Privacy Protected</strong>
                        <p style="margin: 4px 0 0 0; font-size: 12px; color: var(--text-secondary);">
                            All exports are automatically sanitized. Email addresses, file paths containing usernames, API tokens,
                            and IP addresses are redacted before export. No document content is included.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-secondary modal-close">Cancel</button>
        <button class="btn btn-primary" id="btn-save-settings">Save Settings</button>
    </div>
    </div>
</div>

<!-- Help Modal - Comprehensive Documentation -->
<!-- Help Modal - Comprehensive Documentation System v2.9.6 -->
<div class="modal modal-fullscreen" id="modal-help" role="dialog" aria-modal="true" aria-labelledby="help-title">
    <div class="modal-content help-modal-content">
        <div class="modal-header help-modal-header">
            <h3 id="help-title"><i data-lucide="book-open"></i> Help & Documentation</h3>
            <div class="help-header-actions">
                <!-- v2.9.6: Added search functionality (#55) -->
                <div class="help-search-container">
                    <i data-lucide="search"></i>
                    <input type="text" id="help-search-input" class="help-search-input" placeholder="Search help..." autocomplete="off">
                </div>
                <button class="btn btn-ghost" id="btn-help-print" title="Print this section"><i data-lucide="printer"></i></button>
                <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
            </div>
        </div>
        <div class="modal-body help-modal-body">
            <!-- Sidebar Navigation - v2.9.6: Now dynamically built from HelpDocs.navigation -->
            <nav class="help-sidebar">
                <!-- Navigation will be built dynamically by HelpContent.buildNavigation() -->
                <!-- Fallback static content below will be replaced on init -->
                <div class="help-nav-section">
                    <div class="help-nav-title">Getting Started</div>
                    <button class="help-tab active" data-tab="quick-start"><i data-lucide="zap"></i> Quick Start</button>
                    <button class="help-tab" data-tab="first-review"><i data-lucide="play-circle"></i> First Review</button>
                    <button class="help-tab" data-tab="interface-tour"><i data-lucide="layout"></i> Interface Tour</button>
                </div>
                <div class="help-nav-section">
                    <div class="help-nav-title">Document Review</div>
                    <button class="help-tab" data-tab="loading-docs"><i data-lucide="upload"></i> Loading Documents</button>
                    <button class="help-tab" data-tab="review-types"><i data-lucide="sliders"></i> Review Types</button>
                    <button class="help-tab" data-tab="understanding-results"><i data-lucide="bar-chart-2"></i> Understanding Results</button>
                </div>
                <div class="help-nav-section">
                    <div class="help-nav-title">Quality Checkers</div>
                    <button class="help-tab" data-tab="checker-acronyms"><i data-lucide="a-large-small"></i> Acronyms</button>
                    <button class="help-tab" data-tab="checker-grammar"><i data-lucide="spell-check"></i> Grammar</button>
                    <button class="help-tab" data-tab="checker-hyperlinks"><i data-lucide="link"></i> Hyperlinks</button>
                    <button class="help-tab" data-tab="checker-requirements"><i data-lucide="list-checks"></i> Requirements</button>
                    <button class="help-tab" data-tab="checker-all"><i data-lucide="list"></i> All Checkers</button>
                </div>
                <div class="help-nav-section">
                    <div class="help-nav-title">Roles & Statement Forge</div>
                    <button class="help-tab" data-tab="role-detection"><i data-lucide="users"></i> Role Detection</button>
                    <button class="help-tab" data-tab="role-matrix"><i data-lucide="grid-3x3"></i> RACI Matrix</button>
                    <button class="help-tab" data-tab="forge-overview"><i data-lucide="hammer"></i> Statement Forge</button>
                </div>
                <div class="help-nav-section">
                    <div class="help-nav-title">Reference</div>
                    <button class="help-tab" data-tab="shortcuts"><i data-lucide="keyboard"></i> Shortcuts</button>
                    <button class="help-tab" data-tab="trouble-common"><i data-lucide="wrench"></i> Troubleshooting</button>
                    <button class="help-tab" data-tab="version-history"><i data-lucide="history"></i> Version History</button>
                    <button class="help-tab" data-tab="about"><i data-lucide="info"></i> About</button>
                </div>
                <div class="help-nav-footer">
                    <span class="help-version" id="help-version">v3.0.44</span>
                    <span class="help-credit">Nicholas Georgeson</span>
                </div>
            </nav>
            
            <!-- Main Content Area - v2.9.6: Content rendered dynamically by HelpContent -->
            <main class="help-main">
                <!-- v2.9.6: Content rendered dynamically by HelpContent.renderSection() -->
                <!-- Initial loading placeholder -->
                <div class="help-section" id="help-loading">
                    <h1>Loading Help...</h1>
                    <p>Please wait while help content loads.</p>
                </div>
            </main>
        </div>
    </div>
</div>

<!-- Issue Detail Modal -->
<div class="modal modal-lg" id="modal-issue-detail">
    <div class="modal-content">
        <div class="modal-header">
        <h3><i data-lucide="alert-circle"></i> Issue Details</h3>
        <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
    </div>
    <div class="modal-body">
        <div class="issue-detail">
            <div class="detail-header">
                <span id="detail-severity" class="severity-badge"></span>
                <span id="detail-category" class="category-badge"></span>
            </div>
            <div class="detail-section">
                <label>Issue</label>
                <p id="detail-message" class="detail-message"></p>
            </div>
            <div class="detail-section" id="detail-flagged-section">
                <label>Flagged Text</label>
                <code id="detail-flagged" class="detail-code"></code>
            </div>
            <div class="detail-section" id="detail-suggestion-section">
                <label>Suggestion</label>
                <p id="detail-suggestion" class="detail-suggestion"></p>
            </div>
            <div class="detail-section">
                <label>Paragraph Context</label>
                <p id="detail-paragraph" class="paragraph-preview"></p>
            </div>
            <div class="detail-section detail-location">
                <label>Location</label>
                <span><i data-lucide="map-pin"></i> Paragraph <span id="detail-para-num">--</span></span>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-secondary" id="btn-prev-issue"><i data-lucide="chevron-left"></i> Previous</button>
        <button class="btn btn-secondary" id="btn-next-issue">Next <i data-lucide="chevron-right"></i></button>
        <button class="btn btn-primary modal-close">Close</button>
    </div>
    </div>
</div>

<!-- Roles Report Modal - v2.9.7: Sidebar Navigation -->
<div class="modal modal-fullscreen" id="modal-roles" role="dialog" aria-modal="true" aria-labelledby="modal-roles-title">
    <div class="modal-content roles-modal-content">
        <div class="modal-header roles-modal-header">
            <h3 id="modal-roles-title"><i data-lucide="users"></i> Roles & Responsibilities Studio</h3>
            <div class="roles-header-actions">
                <!-- v2.9.7: Search functionality for roles -->
                <div class="roles-search-container">
                    <i data-lucide="search"></i>
                    <input type="text" id="roles-global-search" class="roles-search-input" placeholder="Search roles..." autocomplete="off">
                </div>
                <!-- v3.0.98: Document filter dropdown -->
                <div class="roles-document-filter">
                    <span class="roles-document-filter-label">Filter by Document:</span>
                    <select id="roles-document-filter" class="form-select" title="Filter roles by source document">
                        <option value="all">All Documents</option>
                        <!-- Populated dynamically -->
                    </select>
                </div>
                <!-- v3.0.80: Export dropdown with All/Selected options -->
                <div class="dropdown" id="roles-export-dropdown">
                    <button class="btn btn-ghost" id="btn-export-roles-report" title="Export Roles">
                        <i data-lucide="download"></i>
                        <i data-lucide="chevron-down" style="width:12px;height:12px;margin-left:2px;"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-right" id="roles-export-menu">
                        <button class="dropdown-item" id="btn-export-all-csv">
                            <i data-lucide="file-spreadsheet"></i> Export All Roles (CSV)
                        </button>
                        <button class="dropdown-item" id="btn-export-current-csv">
                            <i data-lucide="file-text"></i> Export Current Document (CSV)
                        </button>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item" id="btn-export-all-json">
                            <i data-lucide="braces"></i> Export All Roles (JSON)
                        </button>
                        <button class="dropdown-item" id="btn-export-selected-doc-csv">
                            <i data-lucide="file-check"></i> Export Selected Document...
                        </button>
                    </div>
                </div>
                <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
            </div>
        </div>
        <div class="modal-body roles-modal-body">
            <!-- v2.9.7: Sidebar Navigation (matching help modal pattern) -->
            <nav class="roles-sidebar" role="tablist">
                <div class="roles-nav-section">
                    <div class="roles-nav-title">Analysis</div>
                    <button class="roles-nav-item active" data-tab="overview" role="tab" aria-selected="true">
                        <i data-lucide="layout-dashboard"></i> Overview
                    </button>
                    <button class="roles-nav-item" data-tab="graph" role="tab" aria-selected="false">
                        <i data-lucide="git-branch"></i> Relationship Graph
                    </button>
                    <button class="roles-nav-item" data-tab="details" role="tab" aria-selected="false">
                        <i data-lucide="list"></i> Role Details
                    </button>
                    <button class="roles-nav-item" data-tab="matrix" role="tab" aria-selected="false">
                        <i data-lucide="grid-3x3"></i> RACI Matrix
                    </button>
                    <button class="roles-nav-item" data-tab="roledocmatrix" role="tab" aria-selected="false">
                        <i data-lucide="table-2"></i> Role-Doc Matrix
                    </button>
                </div>
                <div class="roles-nav-section">
                    <div class="roles-nav-title">Workflow</div>
                    <button class="roles-nav-item" data-tab="adjudication" role="tab" aria-selected="false">
                        <i data-lucide="check-circle"></i> Adjudication
                    </button>
                </div>
                <div class="roles-nav-section">
                    <div class="roles-nav-title">Management</div>
                    <button class="roles-nav-item" data-tab="dictionary" role="tab" aria-selected="false">
                        <i data-lucide="book-open"></i> Role Dictionary
                    </button>
                    <button class="roles-nav-item" data-tab="documents" role="tab" aria-selected="false">
                        <i data-lucide="file-text"></i> Document Log
                    </button>
                </div>
                <div class="roles-nav-footer">
                    <div class="roles-stats-mini">
                        <span><strong id="sidebar-roles-count">0</strong> roles</span>
                        <span><strong id="sidebar-resp-count">0</strong> responsibilities</span>
                    </div>
                </div>
            </nav>
            
            <!-- Main Content Area -->
            <main class="roles-main">
            
            <!-- Overview Tab -->
            <div class="roles-section" id="roles-overview" role="tabpanel" aria-labelledby="tab-overview">
                <div class="roles-summary-grid">
                    <div class="roles-summary-card">
                        <div class="summary-icon"><i data-lucide="users"></i></div>
                        <div class="summary-value" id="total-roles-count">0</div>
                        <div class="summary-label">Unique Roles</div>
                    </div>
                    <div class="roles-summary-card">
                        <div class="summary-icon"><i data-lucide="list-checks"></i></div>
                        <div class="summary-value" id="total-responsibilities-count">0</div>
                        <div class="summary-label">Responsibilities</div>
                    </div>
                    <div class="roles-summary-card">
                        <div class="summary-icon"><i data-lucide="file-text"></i></div>
                        <div class="summary-value" id="total-documents-count">1</div>
                        <div class="summary-label">Documents Analyzed</div>
                    </div>
                    <div class="roles-summary-card">
                        <div class="summary-icon"><i data-lucide="git-branch"></i></div>
                        <div class="summary-value" id="total-interactions-count">0</div>
                        <div class="summary-label">Role Interactions</div>
                    </div>
                </div>
                
                <!-- v3.0.12: Entity audit info bar -->
                <div class="entity-audit-bar" id="entity-audit-bar" style="display: none;">
                    <i data-lucide="info"></i>
                    <span id="entity-audit-text">Export will include 0 roles</span>
                </div>
                
                <div class="roles-chart-container">
                    <h4>Responsibility Distribution</h4>
                    <div class="roles-bar-chart" id="roles-distribution-chart">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                
                <div class="roles-top-list">
                    <h4>Top Roles by Responsibility Count</h4>
                    <div id="top-roles-list">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
            
            <!-- Graph Tab -->
            <div class="roles-section" id="roles-graph" style="display:none;">
                <!-- Live Stats Bar -->
                <div class="graph-stats-bar" id="graph-stats-bar">
                    <span class="graph-stat"><strong id="graph-node-count">0</strong> Nodes</span>
                    <span class="graph-stat"><strong id="graph-link-count">0</strong> Links</span>
                    <span class="graph-stat"><strong id="graph-visible-links">0</strong> Visible</span>
                    <span class="graph-stat">Threshold: <strong id="graph-threshold">1</strong></span>
                    <span class="graph-stat">Max: <strong id="graph-max-weight">--</strong></span>
                </div>
                
                <div class="graph-controls">
                    <div class="graph-control-group">
                        <label for="graph-search">Search:</label>
                        <input type="text" id="graph-search" class="form-input" placeholder="Highlight nodes...">
                        <span id="graph-search-count" class="search-count"></span>
                    </div>
                    <div class="graph-control-group slider-group">
                        <label for="graph-weight-filter">Min. Weight:</label>
                        <input type="range" id="graph-weight-filter" min="1" max="20" value="1" disabled>
                        <span id="graph-weight-value">1</span>
                        <span class="slider-loading" id="slider-loading">Loading...</span>
                    </div>
                    <div class="graph-control-group">
                        <label for="graph-max-nodes">Max Nodes:</label>
                        <select id="graph-max-nodes" class="form-select">
                            <option value="50">50 nodes</option>
                            <option value="100" selected>100 nodes</option>
                            <option value="200">200 nodes</option>
                            <option value="500">500 nodes (slower)</option>
                        </select>
                    </div>
                    <div class="graph-control-group">
                        <label for="graph-layout">Layout:</label>
                        <select id="graph-layout" class="form-select">
                            <option value="force" selected>Force-Directed</option>
                            <option value="bipartite">Bipartite (Roles | Docs)</option>
                        </select>
                    </div>
                    <div class="graph-control-group">
                        <label for="graph-labels">Labels:</label>
                        <select id="graph-labels" class="form-select">
                            <option value="selected" selected>Selected Only</option>
                            <option value="hover">On Hover</option>
                            <option value="all">All (slower)</option>
                            <option value="none">None</option>
                        </select>
                    </div>
                    <div class="graph-control-buttons">
                        <button class="btn btn-secondary btn-sm" id="btn-clear-graph-selection" title="Clear selection">
                            <i data-lucide="x-circle"></i> Clear
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-reset-graph-view" title="Reset zoom and pan">
                            <i data-lucide="maximize-2"></i> Reset
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-refresh-graph" title="Reload graph data">
                            <i data-lucide="refresh-cw"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <!-- v3.0.77: Enhanced Self-Explanatory Legend -->
                <div class="graph-first-time-hint" id="graph-first-time-hint">
                    <i data-lucide="mouse-pointer-click"></i>
                    <span><strong>Tip:</strong> Click any node to see details. Drag to rearrange. Scroll to zoom.</span>
                    <span class="dismiss-hint" onclick="this.parentElement.style.display='none'" title="Dismiss">✕</span>
                </div>
                
                <div class="graph-legend">
                    <!-- Node Types -->
                    <span class="legend-item"><span class="legend-dot role-dot"></span> Role</span>
                    <span class="legend-item"><span class="legend-dot doc-dot"></span> Document</span>
                    <span class="legend-item"><span class="legend-dot deliverable-dot"></span> Deliverable</span>
                    <span class="legend-item"><span class="legend-dot system-dot"></span> System/Tool</span>
                    <span class="legend-item"><span class="legend-dot org-dot"></span> Organization</span>
                    <span class="legend-divider">|</span>
                    
                    <!-- Node Size Explanation -->
                    <span class="legend-item" title="Larger nodes = more mentions">
                        <span class="legend-visual-example">
                            <span class="legend-node-small" style="background:#4A90D9"></span>
                            <span style="margin:0 2px">→</span>
                            <span class="legend-node-large" style="background:#4A90D9"></span>
                        </span>
                        Size = mentions
                    </span>
                    <span class="legend-divider">|</span>
                    
                    <!-- Line Types -->
                    <span class="legend-item" title="Solid line: Role appears in Document">
                        <span class="legend-line-solid"></span> In document
                    </span>
                    <span class="legend-item" title="Dashed line: Roles appear together in same document(s)">
                        <span class="legend-line-dashed"></span> Co-occur
                    </span>
                    <span class="legend-divider">|</span>
                    
                    <!-- Line Thickness -->
                    <span class="legend-item" title="Thicker lines = stronger connection">
                        <span class="legend-visual-example">
                            <span class="legend-line-thin"></span>
                            <span style="margin:0 2px">→</span>
                            <span class="legend-line-thick"></span>
                        </span>
                        Thickness = strength
                    </span>
                    <span class="legend-divider">|</span>
                    
                    <!-- Connection Strength -->
                    <span class="legend-item" title="Dashed border = few connections">
                        <span class="legend-node-weak"></span> Weak
                    </span>
                    <span class="legend-item" title="Solid fill = many connections">
                        <span class="legend-node-strong"></span> Strong
                    </span>
                </div>
                
                <!-- D3 Graph Container -->
                <div class="graph-container" id="roles-graph-container">
                    <!-- BATCH E3: Performance Notice (v2.9.0) -->
                    <div class="graph-performance-notice" id="graph-performance-notice">
                        <i data-lucide="zap"></i>
                        <span>Performance mode: Effects reduced for large graph (>50 nodes)</span>
                    </div>
                    
                    <svg id="roles-graph-svg" width="100%" height="500"></svg>
                    <div class="graph-loading" id="graph-loading" style="display:none;">
                        <i data-lucide="loader" class="spin"></i> Loading graph...
                    </div>
                    
                    <!-- BATCH E3: Link Legend (v2.9.0) -->
                    <div class="graph-link-legend" id="graph-link-legend">
                        <span class="legend-title">Link Types:</span>
                        <div class="link-legend-item">
                            <span class="link-legend-line solid"></span>
                            <span>Role-Document</span>
                        </div>
                        <div class="link-legend-item">
                            <span class="link-legend-line dashed"></span>
                            <span>Role-Deliverable</span>
                        </div>
                        <div class="link-legend-item">
                            <span class="link-legend-line dotted"></span>
                            <span>Coordination</span>
                        </div>
                    </div>
                </div>
                
                <!-- Fallback Table (when D3 unavailable) -->
                <div class="graph-fallback" id="graph-fallback" style="display:none;">
                    <p class="fallback-notice">
                        <i data-lucide="alert-triangle"></i>
                        Graph visualization unavailable. Showing table view instead.
                    </p>
                    <div class="fallback-controls">
                        <input type="text" id="fallback-role-search" class="form-input" placeholder="Filter by role...">
                        <input type="text" id="fallback-doc-search" class="form-input" placeholder="Filter by document...">
                        <select id="fallback-sort" class="form-select">
                            <option value="weight-desc">Weight (High → Low)</option>
                            <option value="weight-asc">Weight (Low → High)</option>
                            <option value="role-asc">Role (A → Z)</option>
                            <option value="doc-asc">Document (A → Z)</option>
                        </select>
                        <label class="checkbox-label fallback-checkbox">
                            <input type="checkbox" id="fallback-match-selection">
                            <span>Match graph selection</span>
                        </label>
                    </div>
                    <div class="fallback-table-container">
                        <table class="data-table" id="graph-fallback-table">
                            <thead>
                                <tr>
                                    <th class="sortable-col" data-sort="role">Role <i data-lucide="chevron-up" class="sort-icon"></i></th>
                                    <th class="sortable-col" data-sort="doc">Document <i data-lucide="chevron-up" class="sort-icon"></i></th>
                                    <th class="sortable-col" data-sort="weight">Mentions <i data-lucide="chevron-up" class="sort-icon"></i></th>
                                    <th>Top Actions</th>
                                </tr>
                            </thead>
                            <tbody id="graph-fallback-body">
                                <!-- Populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Selected Node Info Panel -->
                <div class="graph-info-panel" id="graph-info-panel" style="display:none;">
                    <div class="info-panel-header">
                        <span id="info-panel-title">Node Info</span>
                        <div class="info-panel-actions">
                            <button class="btn btn-ghost btn-xs" id="btn-pin-selection" title="Pin selection (keeps highlight when clicking elsewhere)">
                                <i data-lucide="pin"></i>
                            </button>
                            <button class="btn btn-ghost btn-xs" id="btn-close-info-panel" aria-label="Close panel">
                                <i data-lucide="x"></i>
                            </button>
                        </div>
                    </div>
                    <div class="info-panel-body" id="info-panel-body">
                        <!-- Populated on node click -->
                    </div>
                </div>
                
                <!-- Graph Help Tooltip (shows on help button click) -->
                <div class="graph-help-popup" id="graph-help-popup" style="display:none;">
                    <div class="help-popup-header">
                        <strong>Graph Interactions</strong>
                        <button class="btn btn-ghost btn-xs" id="btn-close-graph-help" aria-label="Close help">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    <ul class="help-popup-list">
                        <li><strong>Click Role</strong> → Highlight connected documents, show role details</li>
                        <li><strong>Click Document</strong> → Highlight roles found in it, show document info</li>
                        <li><strong>Pin Button</strong> → Keep selection highlighted while exploring</li>
                        <li><strong>Drag Node</strong> → Reposition node</li>
                        <li><strong>Scroll</strong> → Zoom in/out</li>
                        <li><strong>Click Background</strong> → Clear selection (unless pinned)</li>
                        <li><strong>Search Box</strong> → Highlight matching nodes</li>
                        <li><strong>Tab + Enter</strong> → Navigate and select with keyboard</li>
                    </ul>
                </div>
            </div>
            
            <!-- Details Tab -->
            <div class="roles-section" id="roles-details" style="display:none;">
                <div class="roles-filter-bar">
                    <input type="text" id="roles-search" class="form-input" placeholder="Search roles...">
                    <select id="roles-sort" class="form-select">
                        <option value="count-desc">Most Responsibilities</option>
                        <option value="count-asc">Least Responsibilities</option>
                        <option value="alpha">Alphabetical</option>
                    </select>
                </div>
                <div class="roles-report" id="roles-report-content">
                    <!-- Populated dynamically -->
                </div>
            </div>
            
            <!-- Matrix Tab - v2.9.7: Interactive RACI Matrix -->
            <div class="roles-section" id="roles-matrix" style="display:none;">
                <div class="raci-header">
                    <h4><i data-lucide="grid-3x3"></i> RACI Responsibility Matrix</h4>
                    <p class="help-text">Click cells to edit RACI assignments. R=Responsible, A=Accountable, C=Consulted, I=Informed.</p>
                </div>
                
                <div class="raci-toolbar">
                    <div class="raci-controls-left">
                        <label class="checkbox-label">
                            <input type="checkbox" id="matrix-filter-critical">
                            <span>Show only roles in Critical/High issues</span>
                        </label>
                        <select id="matrix-sort" class="form-select" style="width:auto;">
                            <option value="frequency">Sort by Frequency</option>
                            <option value="alpha">Sort Alphabetically</option>
                        </select>
                    </div>
                    <div class="raci-controls-right">
                        <button class="btn btn-secondary btn-sm" id="btn-raci-reset" title="Reset to detected values">
                            <i data-lucide="rotate-ccw"></i> Reset
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-raci-export">
                            <i data-lucide="download"></i> Export CSV
                        </button>
                    </div>
                </div>
                
                <div class="raci-matrix-info">
                    <i data-lucide="info"></i>
                    <span>Values show action verb counts from document. Click any cell to override.</span>
                </div>
                
                <div class="responsibility-matrix" id="responsibility-matrix">
                    <!-- Populated dynamically with interactive cells -->
                </div>
                
                <div class="raci-legend-bar">
                    <span class="raci-legend-item"><span class="raci-dot raci-r"></span> <strong>R</strong> = Responsible (shall, must, performs)</span>
                    <span class="raci-legend-item"><span class="raci-dot raci-a"></span> <strong>A</strong> = Accountable (approves, authorizes)</span>
                    <span class="raci-legend-item"><span class="raci-dot raci-c"></span> <strong>C</strong> = Consulted (reviews, coordinates)</span>
                    <span class="raci-legend-item"><span class="raci-dot raci-i"></span> <strong>I</strong> = Informed (notifies, reports)</span>
                </div>
            </div>
            
            <!-- Role-Document Matrix Tab - v3.0.97: Cross-document role mapping -->
            <div class="roles-section" id="roles-roledocmatrix" style="display:none;">
                <div class="roledoc-header">
                    <h4><i data-lucide="table-2"></i> Role-Document Matrix</h4>
                    <p class="help-text">Cross-reference showing which roles appear in which documents. ✓ indicates the role was found in that document.</p>
                </div>
                
                <div class="roledoc-toolbar">
                    <div class="roledoc-controls-left">
                        <label class="checkbox-label">
                            <input type="checkbox" id="roledoc-show-counts">
                            <span>Show mention counts</span>
                        </label>
                    </div>
                    <div class="roledoc-controls-right">
                        <button class="btn btn-secondary btn-sm" id="btn-roledoc-refresh" title="Refresh matrix data">
                            <i data-lucide="refresh-cw"></i> Refresh
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-roledoc-export-csv" title="Export to CSV">
                            <i data-lucide="download"></i> CSV
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-roledoc-export-excel" title="Export to Excel">
                            <i data-lucide="file-spreadsheet"></i> Excel
                        </button>
                    </div>
                </div>
                
                <div class="roledoc-matrix-info">
                    <i data-lucide="info"></i>
                    <span>This matrix aggregates role data from all scanned documents in your history. Scan multiple documents to see cross-document patterns.</span>
                </div>
                
                <div class="roledoc-matrix-container" id="roledoc-matrix-container">
                    <p class="text-muted">Loading matrix data...</p>
                </div>
                
                <p class="roledoc-empty" id="roledoc-empty" style="display:none;">
                    No cross-document role data available. Scan at least two documents to see role-document relationships.
                </p>
            </div>
            
            <!-- Role Adjudication Tab - v2.9.7: Enhanced with bulk operations -->
            <div class="roles-section" id="roles-adjudication" style="display:none;">
                <div class="adjudication-header">
                    <h4><i data-lucide="check-circle"></i> Role Adjudication</h4>
                    <p class="help-text">Review and validate extracted roles. Use bulk actions to quickly process multiple items.</p>
                </div>
                
                <div class="adjudication-stats" style="display:flex;gap:20px;margin-bottom:16px;padding:12px;background:var(--bg-secondary);border-radius:8px;">
                    <div><strong id="adj-pending-count">0</strong> <span class="text-muted">Pending</span></div>
                    <div><strong id="adj-confirmed-count">0</strong> <span class="text-success">Confirmed Roles</span></div>
                    <div><strong id="adj-deliverable-count">0</strong> <span class="text-info">Deliverables</span></div>
                    <div><strong id="adj-rejected-count">0</strong> <span class="text-error">Rejected</span></div>
                    <div style="flex:1;"></div>
                    <div class="adj-selection-count" id="adj-selection-info" style="display:none;">
                        <strong id="adj-selected-count">0</strong> selected
                    </div>
                </div>
                
                <div class="adjudication-filters" style="margin-bottom:16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
                    <label class="checkbox-label adj-select-all-label">
                        <input type="checkbox" id="adj-select-all">
                        <span>Select All</span>
                    </label>
                    <select id="adj-filter" class="form-select" style="width:auto;">
                        <option value="all">All Items</option>
                        <option value="pending" selected>Pending Review</option>
                        <option value="confirmed">Confirmed Roles</option>
                        <option value="deliverable">Deliverables</option>
                        <option value="rejected">Rejected</option>
                        <option value="low-confidence">Low Confidence (&lt;70%)</option>
                    </select>
                    <input type="text" id="adj-search" class="form-input" placeholder="Search roles..." style="width:200px;">
                    
                    <!-- v2.9.7: Bulk Actions -->
                    <div class="adj-bulk-actions" id="adj-bulk-actions" style="display:none;">
                        <span class="bulk-divider">|</span>
                        <span class="bulk-label">Bulk:</span>
                        <button class="btn btn-success btn-sm" id="btn-bulk-confirm" title="Confirm all selected as roles">
                            <i data-lucide="user-check"></i> Confirm
                        </button>
                        <button class="btn btn-info btn-sm" id="btn-bulk-deliverable" title="Mark all selected as deliverables">
                            <i data-lucide="file-text"></i> Deliverable
                        </button>
                        <button class="btn btn-error btn-sm" id="btn-bulk-reject" title="Reject all selected">
                            <i data-lucide="x-circle"></i> Reject
                        </button>
                        <button class="btn btn-ghost btn-sm" id="btn-bulk-pending" title="Reset selected to pending">
                            <i data-lucide="clock"></i> Reset
                        </button>
                    </div>
                    
                    <div style="flex:1;"></div>
                    <button class="btn btn-secondary btn-sm" id="btn-export-adjudication">
                        <i data-lucide="download"></i> Export Decisions
                    </button>
                </div>
                
                <div class="adjudication-list" id="adjudication-list">
                    <!-- Populated dynamically -->
                </div>
                
                <div class="adjudication-actions" style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border-default);display:flex;gap:12px;">
                    <button class="btn btn-success" id="btn-save-adjudication">
                        <i data-lucide="save"></i> Save Decisions
                    </button>
                    <button class="btn btn-secondary" id="btn-reset-adjudication">
                        <i data-lucide="rotate-ccw"></i> Reset All
                    </button>
                    <div style="flex:1;"></div>
                    <button class="btn btn-primary" id="btn-apply-adjudication">
                        <i data-lucide="file-check"></i> Apply to Document
                    </button>
                </div>
            </div>
            
            <!-- Role Dictionary Tab -->
            <div class="roles-section" id="roles-dictionary" style="display:none;">
                <div class="dictionary-header">
                    <h4><i data-lucide="book-open"></i> Role Dictionary</h4>
                    <p class="text-muted">Manage known roles used for extraction. Changes affect future scans.</p>
                </div>
                
                <div class="dictionary-toolbar">
                    <input type="text" id="dict-search" class="form-input" placeholder="Search dictionary..." style="width:250px;">
                    <select id="dict-filter-source" class="form-select" style="width:150px;">
                        <option value="">All Sources</option>
                        <option value="builtin">Built-in</option>
                        <option value="manual">Manual</option>
                        <option value="adjudication">Adjudication</option>
                        <option value="upload">Upload</option>
                    </select>
                    <select id="dict-filter-category" class="form-select" style="width:150px;">
                        <option value="">All Categories</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Management">Management</option>
                        <option value="Leadership">Leadership</option>
                        <option value="Government">Government</option>
                        <option value="Board">Board</option>
                        <option value="Stakeholder">Stakeholder</option>
                        <option value="Custom">Custom</option>
                    </select>
                    <div style="flex:1;"></div>
                    <div class="btn-group" title="Team Sharing">
                        <button class="btn btn-secondary btn-sm" id="btn-sync-dictionary" title="Sync from shared master file">
                            <i data-lucide="refresh-cw"></i> Sync
                        </button>
                        <button class="btn btn-secondary btn-sm" id="btn-download-master" title="Download shareable master file">
                            <i data-lucide="share-2"></i> Share
                        </button>
                    </div>
                    <div class="btn-divider"></div>
                    <button class="btn btn-secondary btn-sm" id="btn-seed-dictionary" title="Add built-in roles">
                        <i data-lucide="database"></i> Seed Built-in
                    </button>
                    <button class="btn btn-secondary btn-sm" id="btn-import-dictionary" title="Import from file">
                        <i data-lucide="upload"></i> Import
                    </button>
                    <button class="btn btn-secondary btn-sm" id="btn-export-dictionary" title="Export to CSV">
                        <i data-lucide="download"></i> Export CSV
                    </button>
                    <button class="btn btn-primary btn-sm" id="btn-add-role">
                        <i data-lucide="plus"></i> Add Role
                    </button>
                </div>
                
                <!-- Sharing Info Panel -->
                <div class="dictionary-sharing-info" id="dict-sharing-info">
                    <div class="sharing-status" id="sharing-status">
                        <i data-lucide="info"></i>
                        <span>Dictionary status: <strong id="dict-status-text">Checking...</strong></span>
                    </div>
                </div>
                
                <div class="dictionary-stats" id="dict-stats">
                    <span class="dict-stat"><strong id="dict-total">0</strong> roles</span>
                    <span class="dict-stat"><strong id="dict-active">0</strong> active</span>
                    <span class="dict-stat"><strong id="dict-builtin">0</strong> built-in</span>
                </div>
                
                <div class="dictionary-table-container">
                    <table class="data-table" id="dictionary-table">
                        <thead>
                            <tr>
                                <th style="width:25%;">Role Name</th>
                                <th style="width:15%;">Category</th>
                                <th style="width:15%;">Source</th>
                                <th style="width:20%;">Added/Updated</th>
                                <th style="width:10%;">Status</th>
                                <th style="width:15%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="dictionary-body">
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div class="dictionary-empty" id="dict-empty" style="display:none;">
                    <i data-lucide="book-open"></i>
                    <p>No roles in dictionary. Click "Seed Built-in" to add standard roles, or add your own.</p>
                </div>
            </div>
            
            <!-- Add/Edit Role Modal -->
            <div class="modal" id="edit-role-modal" style="display:none;">
                <div class="modal-overlay"></div>
                <div class="modal-container" style="max-width:500px;">
                    <div class="modal-header">
                        <h3 id="edit-role-title">Add Role</h3>
                        <button class="btn btn-ghost" id="btn-close-role-modal"><i data-lucide="x"></i></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="edit-role-id">
                        <div class="form-group">
                            <label for="edit-role-name">Role Name *</label>
                            <input type="text" id="edit-role-name" class="form-input" placeholder="e.g., Systems Engineer">
                        </div>
                        <div class="form-group">
                            <label for="edit-role-category">Category</label>
                            <select id="edit-role-category" class="form-select">
                                <option value="Custom">Custom</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Management">Management</option>
                                <option value="Leadership">Leadership</option>
                                <option value="Government">Government</option>
                                <option value="Board">Board</option>
                                <option value="Team">Team</option>
                                <option value="Stakeholder">Stakeholder</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-role-aliases">Aliases (comma-separated)</label>
                            <input type="text" id="edit-role-aliases" class="form-input" placeholder="e.g., SE, System Engineer">
                        </div>
                        <div class="form-group">
                            <label for="edit-role-description">Description</label>
                            <textarea id="edit-role-description" class="form-textarea" rows="2" placeholder="Optional description"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="edit-role-deliverable">
                                <span>This is a deliverable/work product (not a role)</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="edit-role-notes">Notes</label>
                            <textarea id="edit-role-notes" class="form-textarea" rows="2" placeholder="Optional notes"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="btn-cancel-role">Cancel</button>
                        <button class="btn btn-primary" id="btn-save-role">Save Role</button>
                    </div>
                </div>
            </div>
            
            <!-- Import Dictionary Modal -->
            <!-- v2.9.1 D2: Smart Import Wizard (5-step flow) -->
            <div class="modal" id="import-dict-modal" style="display:none;">
                <div class="modal-overlay"></div>
                <div class="modal-container" style="max-width:650px;">
                    <div class="modal-header">
                        <h3 id="import-wizard-title">Import Roles - Step 1 of 5</h3>
                        <button class="btn btn-ghost" id="btn-close-import-modal"><i data-lucide="x"></i></button>
                    </div>
                    <div class="modal-body">
                        <!-- Step 1: Select File -->
                        <div class="import-wizard-step" id="import-step-1">
                            <div class="import-dropzone" id="dict-import-dropzone">
                                <i data-lucide="upload"></i>
                                <p>Drop a file here</p>
                                <p class="text-muted">Supports CSV, JSON, TXT, XLSX</p>
                                <input type="file" id="dict-import-file" accept=".csv,.json,.txt,.xlsx,.xls" style="display:none;">
                            </div>
                            <div class="import-format-help" style="margin-top:16px;">
                                <p><strong>Supported formats:</strong></p>
                                <ul style="margin:8px 0;padding-left:20px;">
                                    <li><strong>CSV:</strong> Columns with role names, categories, aliases</li>
                                    <li><strong>JSON:</strong> Array of role objects or TWR export format</li>
                                    <li><strong>TXT:</strong> One role name per line</li>
                                    <li><strong>XLSX:</strong> Excel with role data (first sheet used)</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Step 2: File Analysis -->
                        <div class="import-wizard-step" id="import-step-2" style="display:none;">
                            <div class="import-analysis-result">
                                <h4><i data-lucide="file-search"></i> File Analysis</h4>
                                <div class="analysis-stats" id="import-analysis-stats">
                                    <!-- Populated dynamically -->
                                </div>
                                <div class="analysis-preview" id="import-analysis-preview" style="max-height:200px;overflow-y:auto;margin-top:12px;">
                                    <!-- Sample data preview -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 3: Column Mapping -->
                        <div class="import-wizard-step" id="import-step-3" style="display:none;">
                            <h4><i data-lucide="columns"></i> Map Columns</h4>
                            <p class="text-muted">Match your file columns to role fields:</p>
                            <div class="column-mapping-grid" id="import-column-mapping">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                        
                        <!-- Step 4: Preview & Confirm -->
                        <div class="import-wizard-step" id="import-step-4" style="display:none;">
                            <h4><i data-lucide="eye"></i> Preview Import</h4>
                            <div class="import-preview-summary" id="import-preview-summary">
                                <!-- Summary of what will be imported -->
                            </div>
                            <div class="import-preview-list" id="import-preview-list" style="max-height:250px;overflow-y:auto;margin-top:12px;">
                                <!-- List of roles to import -->
                            </div>
                            <div class="import-options" style="margin-top:16px;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="import-skip-duplicates" checked>
                                    Skip roles already in dictionary
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="import-skip-generic">
                                    Skip generic terms (e.g., "Manager", "Team")
                                </label>
                            </div>
                        </div>
                        
                        <!-- Step 5: Complete -->
                        <div class="import-wizard-step" id="import-step-5" style="display:none;">
                            <div class="import-complete-result" id="import-complete-result">
                                <div class="success-icon" style="text-align:center;margin:20px 0;">
                                    <i data-lucide="check-circle" style="width:64px;height:64px;color:#27AE60;"></i>
                                </div>
                                <h4 style="text-align:center;">Import Complete!</h4>
                                <div id="import-complete-stats" style="text-align:center;margin-top:16px;">
                                    <!-- Final stats -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Progress Indicator -->
                        <div class="import-wizard-progress" style="margin-top:20px;">
                            <div class="progress-steps">
                                <span class="progress-step active" data-step="1">1. Select</span>
                                <span class="progress-step" data-step="2">2. Analyze</span>
                                <span class="progress-step" data-step="3">3. Map</span>
                                <span class="progress-step" data-step="4">4. Preview</span>
                                <span class="progress-step" data-step="5">5. Done</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="justify-content:space-between;">
                        <button class="btn btn-secondary" id="import-wizard-back" style="display:none;">
                            <i data-lucide="arrow-left"></i> Back
                        </button>
                        <div style="display:flex;gap:8px;">
                            <button class="btn btn-secondary" id="import-wizard-cancel">Cancel</button>
                            <button class="btn btn-primary" id="import-wizard-next" disabled>
                                Next <i data-lucide="arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Document Log Tab -->
            <div class="roles-section" id="roles-documents" style="display:none;">
                <div class="document-log-header">
                    <h4>Documents Contributing to Role Analysis</h4>
                    <button class="btn btn-secondary btn-sm" id="btn-clear-role-history">
                        <i data-lucide="trash-2"></i> Clear History
                    </button>
                </div>
                <div class="document-log-table">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Document</th>
                                <th>Analyzed</th>
                                <th>Roles Found</th>
                                <th>Responsibilities</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="document-log-body">
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <p class="document-log-empty" id="document-log-empty" style="display:none;">
                    No documents have been analyzed yet. Scan a document to see role data here.
                </p>
            </div>
            </main><!-- End roles-main -->
        </div>
    </div>
</div>

<!-- Scan History Modal -->
<div class="modal modal-xl" id="modal-scan-history">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="clock"></i> Scan History</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="scan-history-container">
                <div class="scan-history-filters">
                    <input type="text" id="history-search" class="form-input" placeholder="Filter by filename...">
                    <button class="btn btn-secondary" id="btn-refresh-history"><i data-lucide="refresh-cw"></i> Refresh</button>
                </div>
                <div class="scan-history-table">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Document</th>
                                <th>Scan Time</th>
                                <th>Issues</th>
                                <th>Score</th>
                                <th>Grade</th>
                                <th>Changes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="scan-history-body">
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <p class="scan-history-empty" id="scan-history-empty" style="display:none;">
                    No scan history available. Documents will appear here after you scan them.
                </p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modal-close">Close</button>
        </div>
    </div>
</div>

<!-- Save Profile Modal -->
<div class="modal" id="modal-save-profile">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="bookmark"></i> Save Scan Profile</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Profile Name</label>
                <input type="text" id="profile-name" class="form-input" placeholder="e.g., Requirements Review, Grammar Focus">
            </div>
            <div class="form-group">
                <label>Description (optional)</label>
                <input type="text" id="profile-description" class="form-input" placeholder="Brief description of this profile">
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="profile-set-default">
                    <span>Set as default profile</span>
                </label>
            </div>
            <div class="profile-preview">
                <p><strong>Current Settings:</strong></p>
                <ul id="profile-settings-preview">
                    <!-- Populated dynamically -->
                </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary modal-close">Cancel</button>
            <button class="btn btn-primary" id="btn-confirm-save-profile"><i data-lucide="save"></i> Save Profile</button>
        </div>
    </div>
</div>

<!-- Diagnostics Export Modal -->
<div class="modal modal-lg" id="modal-diagnostics" role="dialog" aria-modal="true" aria-labelledby="modal-diagnostics-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-diagnostics-title"><i data-lucide="file-text"></i> Export Diagnostics</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="diagnostics-info">
                <!-- v2.9.4.2: Troubleshooting Export - Primary option -->
                <div class="alert alert-success" style="margin-bottom: 16px;">
                    <i data-lucide="bug"></i>
                    <div>
                        <strong>Troubleshooting Export (Recommended)</strong>
                        <p>Export a self-contained diagnostic package with all information needed
                        to identify and resolve issues.</p>
                        <button class="btn btn-success" id="btn-ai-troubleshoot-json" style="margin-top: 8px;">
                            <i data-lucide="download"></i> Export for Troubleshooting
                        </button>
                        <button class="btn btn-ghost btn-sm" id="btn-ai-troubleshoot-txt" style="margin-top: 8px; margin-left: 8px;">
                            Text Format
                        </button>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <i data-lucide="info"></i>
                    <div>
                        <strong>Standard Diagnostic Export</strong>
                        <p>This export contains error logs and system information to help diagnose issues. 
                        <strong>Proprietary content is automatically sanitized</strong> - document text, file paths, 
                        and personal information are redacted or hashed.</p>
                    </div>
                </div>
                
                <div class="diagnostics-summary" id="diagnostics-summary">
                    <div class="diag-stat">
                        <span class="diag-label">Session ID:</span>
                        <span class="diag-value" id="diag-session-id">-</span>
                    </div>
                    <div class="diag-stat">
                        <span class="diag-label">Errors Captured:</span>
                        <span class="diag-value" id="diag-error-count">0</span>
                    </div>
                    <div class="diag-stat">
                        <span class="diag-label">Warnings:</span>
                        <span class="diag-value" id="diag-warning-count">0</span>
                    </div>
                    <div class="diag-stat">
                        <span class="diag-label">Requests Logged:</span>
                        <span class="diag-value" id="diag-request-count">0</span>
                    </div>
                    <div class="diag-stat">
                        <span class="diag-label">Console Errors:</span>
                        <span class="diag-value" id="diag-console-count">0</span>
                    </div>
                    <div class="diag-stat">
                        <span class="diag-label">User Actions:</span>
                        <span class="diag-value" id="diag-action-count">0</span>
                    </div>
                </div>
                
                <div class="diagnostics-options">
                    <h4>Standard Export Options</h4>
                    <label class="checkbox-label">
                        <input type="checkbox" id="diag-include-system" checked>
                        <span>Include system information (Python version, packages, etc.)</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="diag-include-requests" checked>
                        <span>Include request log (API calls, timing)</span>
                    </label>
                    <div class="form-group" style="margin-top: 12px;">
                        <label>Export Format:</label>
                        <select id="diag-format" class="form-select">
                            <option value="json">JSON (for developers)</option>
                            <option value="txt">Text Report (human readable)</option>
                        </select>
                    </div>
                </div>
                
                <div class="diagnostics-privacy">
                    <h4><i data-lucide="shield"></i> What Gets Sanitized</h4>
                    <ul>
                        <li><strong>File paths:</strong> Middle directories hashed (e.g., C:\Us..._a1b2c3\Documents\...)</li>
                        <li><strong>Document content:</strong> Replaced with [CONTENT:Nchars]</li>
                        <li><strong>Email addresses:</strong> Replaced with [EMAIL]</li>
                        <li><strong>API keys/tokens:</strong> Replaced with [REDACTED]</li>
                        <li><strong>Internal URLs:</strong> Domain hashed, structure preserved</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost" id="btn-capture-state" title="Capture current UI state for debugging">
                <i data-lucide="camera"></i> Capture State
            </button>
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-secondary" id="btn-email-diagnostics" title="Open Outlook with diagnostic report">
                <i data-lucide="mail"></i> Email via Outlook
            </button>
            <button class="btn btn-primary" id="btn-export-diagnostics">
                <i data-lucide="download"></i> Export Diagnostics
            </button>
        </div>
    </div>
</div>

<!-- v3.0.111: Statement Forge Fullscreen Modal (Full Parity with Standalone) -->
<div class="modal modal-fullscreen" id="modal-statement-forge" role="dialog" aria-modal="true" aria-labelledby="modal-sf-title">
    <div class="modal-content sf-fullscreen-content">
        <!-- Sidebar -->
        <aside class="sf-sidebar">
            <div class="sf-sidebar-header">
                <div class="sf-logo">
                    <i data-lucide="hammer" style="width:32px;height:32px;color:var(--accent-blue);"></i>
                    <div class="sf-logo-text">
                        <span class="sf-logo-title">Statement Forge</span>
                        <span class="sf-logo-subtitle">v3.0</span>
                    </div>
                </div>
                <button class="btn btn-ghost btn-sm modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
            </div>

            <nav class="sf-sidebar-nav">
                <!-- Document Type Selector -->
                <div class="sf-nav-section">
                    <div class="sf-nav-section-title">DOCUMENT TYPE</div>
                    <div class="sf-doc-type-selector">
                        <label class="sf-radio-card">
                            <input type="radio" name="sfDocType" value="procedures" checked>
                            <div class="sf-radio-card-content">
                                <i data-lucide="file-text"></i>
                                <span>Procedures</span>
                            </div>
                        </label>
                        <label class="sf-radio-card">
                            <input type="radio" name="sfDocType" value="work_instruction">
                            <div class="sf-radio-card-content">
                                <i data-lucide="list-checks"></i>
                                <span>Work Instruction</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Filter by Directive -->
                <div class="sf-nav-section">
                    <div class="sf-nav-section-title">FILTER BY DIRECTIVE</div>
                    <div class="sf-filter-chips">
                        <button class="sf-filter-chip active" data-filter="all"><span class="sf-chip-dot all"></span>All</button>
                        <button class="sf-filter-chip" data-filter="shall"><span class="sf-chip-dot shall"></span>Shall</button>
                        <button class="sf-filter-chip" data-filter="must"><span class="sf-chip-dot must"></span>Must</button>
                        <button class="sf-filter-chip" data-filter="should"><span class="sf-chip-dot should"></span>Should</button>
                        <button class="sf-filter-chip" data-filter="may"><span class="sf-chip-dot may"></span>May</button>
                        <button class="sf-filter-chip" data-filter="will"><span class="sf-chip-dot will"></span>Will</button>
                        <button class="sf-filter-chip" data-filter="process"><span class="sf-chip-dot process"></span>Process</button>
                    </div>
                </div>

                <!-- Statistics Grid -->
                <div class="sf-nav-section">
                    <div class="sf-nav-section-title">STATISTICS</div>
                    <div class="sf-stats-grid">
                        <div class="sf-stat-card">
                            <div class="sf-stat-value" id="sf-stat-total">0</div>
                            <div class="sf-stat-label">Total</div>
                        </div>
                        <div class="sf-stat-card">
                            <div class="sf-stat-value" id="sf-stat-filtered">0</div>
                            <div class="sf-stat-label">Filtered</div>
                        </div>
                        <div class="sf-stat-card">
                            <div class="sf-stat-value" id="sf-stat-sections">0</div>
                            <div class="sf-stat-label">Sections</div>
                        </div>
                        <div class="sf-stat-card">
                            <div class="sf-stat-value" id="sf-stat-selected">0</div>
                            <div class="sf-stat-label">Selected</div>
                        </div>
                    </div>
                </div>

                <!-- Undo History -->
                <div class="sf-nav-section">
                    <div class="sf-nav-section-title">UNDO HISTORY</div>
                    <div class="sf-undo-info">
                        <span id="sf-undo-count">0</span> undo / <span id="sf-redo-count">0</span> redo available
                    </div>
                </div>
            </nav>

            <div class="sf-sidebar-footer">
                <button class="btn btn-ghost btn-sm" id="sf-btn-settings" title="Settings & Backups"><i data-lucide="settings"></i></button>
                <button class="btn btn-ghost btn-sm" id="sf-btn-help" title="Help (F1)"><i data-lucide="help-circle"></i></button>
                <button class="btn btn-ghost btn-sm" id="sf-map-roles-btn" title="Map statements to detected roles"><i data-lucide="users"></i></button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="sf-main-content">
            <!-- Header with Document Info -->
            <header class="sf-main-header">
                <div class="sf-doc-info">
                    <div class="sf-doc-status" id="sf-doc-status">
                        <span class="sf-status-indicator" id="sf-status-indicator">
                            <i data-lucide="file-x"></i>
                        </span>
                        <span class="sf-status-text" id="sf-status-text">No document</span>
                    </div>
                    <h1 class="sf-doc-title" id="sf-doc-title">No Document Loaded</h1>
                    <p class="sf-doc-subtitle" id="sf-doc-subtitle">Open a document or use current document to begin extraction</p>
                </div>
            </header>

            <!-- Primary Toolbar -->
            <div class="sf-toolbar sf-toolbar-primary">
                <div class="sf-toolbar-group">
                    <label class="btn btn-secondary" for="sf-file-input" title="Open Document (Ctrl+O)">
                        <i data-lucide="folder-open"></i><span>Open</span>
                    </label>
                    <input type="file" id="sf-file-input" accept=".docx,.pdf,.txt,.md" style="display:none;">
                    <button class="btn btn-primary" id="btn-sf-extract" title="Extract Statements">
                        <i data-lucide="zap"></i><span>Extract</span>
                    </button>
                    <div class="sf-export-dropdown">
                        <button class="btn btn-secondary" id="sf-btn-export" disabled title="Export to CSV (Ctrl+S)">
                            <i data-lucide="download"></i><span>Export</span>
                        </button>
                        <div class="sf-dropdown-menu" id="sf-export-menu" style="display:none;">
                            <button class="sf-dropdown-item" data-format="nimbus_csv">CSV (Nimbus Compatible)</button>
                            <button class="sf-dropdown-item" data-format="xlsx">Excel Workbook</button>
                            <button class="sf-dropdown-item" data-format="json">JSON (Full Data)</button>
                            <button class="sf-dropdown-item" data-format="docx">Word Document</button>
                        </div>
                    </div>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost" id="sf-btn-undo" disabled title="Undo (Ctrl+Z)"><i data-lucide="undo-2"></i></button>
                    <button class="btn btn-ghost" id="sf-btn-redo" disabled title="Redo (Ctrl+Y)"><i data-lucide="redo-2"></i></button>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost" id="sf-btn-expand-all" title="Expand All (Ctrl+E)"><i data-lucide="unfold-vertical"></i><span>Expand</span></button>
                    <button class="btn btn-ghost" id="sf-btn-collapse-all" title="Collapse All (Ctrl+Shift+E)"><i data-lucide="fold-vertical"></i><span>Collapse</span></button>
                </div>
                <div class="sf-toolbar-spacer"></div>
                <div class="sf-search-box">
                    <i data-lucide="search"></i>
                    <input type="text" id="sf-search-input" placeholder="Search statements... (Ctrl+F)">
                    <button class="sf-search-clear" id="sf-search-clear" style="display:none"><i data-lucide="x"></i></button>
                </div>
            </div>

            <!-- Secondary Toolbar -->
            <div class="sf-toolbar sf-toolbar-secondary">
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost btn-sm" id="sf-btn-add" title="Add Statement (Insert)"><i data-lucide="plus"></i><span>Add</span></button>
                    <button class="btn btn-ghost btn-sm" id="sf-btn-delete" disabled title="Delete Selected (Delete)"><i data-lucide="trash-2"></i><span>Delete</span></button>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost btn-sm" id="sf-btn-merge" disabled title="Merge Selected (Ctrl+M)"><i data-lucide="git-merge"></i><span>Merge</span></button>
                    <button class="btn btn-ghost btn-sm" id="sf-btn-split" disabled title="Split Statement"><i data-lucide="split"></i><span>Split</span></button>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost btn-sm" id="sf-btn-move-up" disabled title="Move Up (Alt+↑)"><i data-lucide="chevron-up"></i></button>
                    <button class="btn btn-ghost btn-sm" id="sf-btn-move-down" disabled title="Move Down (Alt+↓)"><i data-lucide="chevron-down"></i></button>
                    <button class="btn btn-ghost btn-sm" id="sf-btn-indent-left" disabled title="Outdent (Alt+←)"><i data-lucide="arrow-left-to-line"></i></button>
                    <button class="btn btn-ghost btn-sm" id="sf-btn-indent-right" disabled title="Indent (Alt+→)"><i data-lucide="arrow-right-to-line"></i></button>
                </div>
                <div class="sf-toolbar-divider"></div>
                <div class="sf-toolbar-group">
                    <button class="btn btn-ghost btn-sm" id="sf-btn-renumber" disabled title="Renumber Statements"><i data-lucide="hash"></i><span>Renumber</span></button>
                </div>
                <div class="sf-toolbar-spacer"></div>
                <div class="sf-selection-info" id="sf-selection-info" style="display:none;">
                    <span id="sf-selection-count">0</span> selected
                </div>
            </div>

            <!-- Content Area with Table -->
            <div class="sf-content-area">
                <div class="sf-table-container">
                    <div class="sf-table-header">
                        <div class="sf-th sf-th-drag"></div>
                        <div class="sf-th sf-th-checkbox"><input type="checkbox" id="sf-select-all" title="Select All (Ctrl+A)"></div>
                        <div class="sf-th sf-th-expand"></div>
                        <div class="sf-th sf-th-number">Number</div>
                        <div class="sf-th sf-th-description">Description</div>
                        <div class="sf-th sf-th-role">Role</div>
                        <div class="sf-th sf-th-directive">Type</div>
                        <div class="sf-th sf-th-level">Lvl</div>
                        <div class="sf-th sf-th-actions"></div>
                    </div>
                    <div class="sf-table-body" id="sf-statements-table">
                        <div class="sf-empty-state" id="sf-empty-state">
                            <div class="sf-empty-icon"><i data-lucide="file-search"></i></div>
                            <h3>No Statements</h3>
                            <p>Open a document and click Extract to begin, or use current document</p>
                            <div class="sf-empty-actions">
                                <label class="btn btn-primary" for="sf-file-input-empty"><i data-lucide="folder-open"></i>Open Document</label>
                                <input type="file" id="sf-file-input-empty" accept=".docx,.pdf,.txt,.md" style="display:none;">
                                <button class="btn btn-secondary" id="sf-btn-use-current" title="Use currently loaded document">
                                    <i data-lucide="file-text"></i>Use Current Document
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shortcuts Bar -->
            <div class="sf-shortcuts-bar">
                <span><kbd>↑↓</kbd> Navigate</span>
                <span><kbd>Space</kbd> Select</span>
                <span><kbd>Enter</kbd> Edit</span>
                <span><kbd>Del</kbd> Delete</span>
                <span><kbd>Alt+↑↓</kbd> Move</span>
                <span><kbd>Alt+←→</kbd> Indent</span>
                <span><kbd>Ctrl+M</kbd> Merge</span>
                <span><kbd>F1</kbd> Help</span>
                <span><kbd>Esc</kbd> Close</span>
            </div>
        </main>

        <!-- Edit Panel (Slides in from right) -->
        <aside class="sf-edit-panel" id="sf-edit-panel">
            <div class="sf-edit-panel-header">
                <h2>Edit Statement</h2>
                <button class="btn btn-ghost" id="sf-btn-close-edit"><i data-lucide="x"></i></button>
            </div>
            <div class="sf-edit-panel-content">
                <div class="form-group">
                    <label>Statement Number</label>
                    <input type="text" id="sf-edit-number" class="form-input" placeholder="e.g., 3.2.1">
                </div>
                <div class="form-group">
                    <label>Title (optional)</label>
                    <input type="text" id="sf-edit-title" class="form-input" placeholder="Section or requirement title">
                </div>
                <div class="form-group">
                    <label>Responsible Role</label>
                    <input type="text" id="sf-edit-role" class="form-input" placeholder="e.g., System Engineer">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="sf-edit-description" class="form-textarea" rows="8" placeholder="The full statement text..."></textarea>
                </div>
                <div class="sf-form-row">
                    <div class="form-group">
                        <label>Hierarchy Level</label>
                        <div class="sf-level-selector">
                            <button class="sf-level-btn" data-level="1" title="Major Section">1</button>
                            <button class="sf-level-btn" data-level="2" title="Sub-section">2</button>
                            <button class="sf-level-btn" data-level="3" title="Topic">3</button>
                            <button class="sf-level-btn" data-level="4" title="Statement">4</button>
                            <button class="sf-level-btn" data-level="5" title="Sub-statement">5</button>
                            <button class="sf-level-btn" data-level="6" title="Detail">6</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Directive Type</label>
                        <select id="sf-edit-directive" class="form-select">
                            <option value="">Process (no directive)</option>
                            <option value="shall">Shall (mandatory)</option>
                            <option value="must">Must (mandatory)</option>
                            <option value="should">Should (recommended)</option>
                            <option value="may">May (optional)</option>
                            <option value="will">Will (intent)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="sf-edit-panel-footer">
                <button class="btn btn-ghost" id="sf-btn-cancel-edit">Cancel</button>
                <button class="btn btn-primary" id="sf-btn-save-edit"><i data-lucide="check"></i>Save Changes</button>
            </div>
        </aside>
    </div>
</div>

<!-- Statement Forge: Add Statement Modal -->
<div class="modal modal-sm" id="modal-sf-add" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="plus"></i> Add New Statement</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Statement Number</label>
                <input type="text" id="sf-add-number" class="form-input" placeholder="e.g., 4.1.1">
            </div>
            <div class="form-group">
                <label>Description *</label>
                <textarea id="sf-add-description" class="form-textarea" rows="4" placeholder="Enter the statement text..."></textarea>
            </div>
            <div class="sf-form-row">
                <div class="form-group">
                    <label>Level</label>
                    <select id="sf-add-level" class="form-select">
                        <option value="1">1 - Major Section</option>
                        <option value="2">2 - Sub-section</option>
                        <option value="3">3 - Topic</option>
                        <option value="4" selected>4 - Statement</option>
                        <option value="5">5 - Sub-statement</option>
                        <option value="6">6 - Detail</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Directive</label>
                    <select id="sf-add-directive" class="form-select">
                        <option value="">Process</option>
                        <option value="shall">Shall</option>
                        <option value="must">Must</option>
                        <option value="should">Should</option>
                        <option value="may">May</option>
                        <option value="will">Will</option>
                    </select>
                </div>
            </div>
            <p class="text-muted" style="font-size:12px;margin-top:8px;">New statement will be added after the selected row, or at the end if none selected.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-primary" id="sf-btn-add-confirm"><i data-lucide="plus"></i>Add Statement</button>
        </div>
    </div>
</div>

<!-- Statement Forge: Renumber Modal -->
<div class="modal modal-sm" id="modal-sf-renumber" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="hash"></i> Renumber Statements</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Base Number</label>
                <input type="text" id="sf-renumber-base" class="form-input" placeholder="e.g., 1 or 4.1" value="1">
            </div>
            <div class="form-group">
                <label>Numbering Strategy</label>
                <select id="sf-renumber-strategy" class="form-select">
                    <option value="hierarchical">Hierarchical (respects indent levels)</option>
                    <option value="sequential">Sequential (1.1, 1.2, 1.3...)</option>
                    <option value="continue">Continue (for merged documents)</option>
                </select>
                <p class="text-muted" style="font-size:12px;margin-top:4px;" id="sf-strategy-hint">Maintains hierarchy: 1.0 → 1.1 → 1.1.1</p>
            </div>
            <p class="text-muted" style="font-size:12px;">Will renumber <strong id="sf-renumber-count">0</strong> statements. Selected statements will be renumbered, or all visible if none selected.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-primary" id="sf-btn-renumber-confirm"><i data-lucide="hash"></i>Renumber</button>
        </div>
    </div>
</div>

<!-- Statement Forge: Merge Modal -->
<div class="modal modal-sm" id="modal-sf-merge" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="git-merge"></i> Merge Statements</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <p>Combine <strong id="sf-merge-count">0</strong> selected statements into one.</p>
            <div class="form-group">
                <label>Text Separator</label>
                <select id="sf-merge-separator" class="form-select">
                    <option value="\n\n">Double newline (paragraphs)</option>
                    <option value="\n">Single newline</option>
                    <option value=" ">Space</option>
                    <option value="; ">Semicolon</option>
                </select>
            </div>
            <p class="text-muted" style="font-size:12px;margin-top:8px;">The first selected statement's number, title, and role will be preserved.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-primary" id="sf-btn-merge-confirm"><i data-lucide="git-merge"></i>Merge Statements</button>
        </div>
    </div>
</div>

<!-- Statement Forge: Split Modal -->
<div class="modal modal-sm" id="modal-sf-split" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="split"></i> Split Statement</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Split By</label>
                <select id="sf-split-by" class="form-select">
                    <option value="\n\n">Double newline (paragraphs)</option>
                    <option value="\n">Single newline</option>
                    <option value=". ">Sentences (period + space)</option>
                    <option value="; ">Semicolon</option>
                </select>
            </div>
            <div id="sf-split-preview" class="sf-split-preview">
                <p class="text-muted">Select a statement to see preview</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost modal-close">Cancel</button>
            <button class="btn btn-primary" id="sf-btn-split-confirm"><i data-lucide="split"></i>Split Statement</button>
        </div>
    </div>
</div>

<!-- Statement Forge: Help Modal -->
<div class="modal modal-lg" id="modal-sf-help" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="help-circle"></i> Statement Forge - Help</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body sf-help-content">
            <div class="sf-help-tabs">
                <button class="sf-help-tab-btn active" data-help-tab="overview">What Is This?</button>
                <button class="sf-help-tab-btn" data-help-tab="howto">How To Use</button>
                <button class="sf-help-tab-btn" data-help-tab="shortcuts">Shortcuts</button>
            </div>

            <div class="sf-help-tab-content active" id="sf-help-overview">
                <h4>What Is Statement Forge?</h4>
                <p>Statement Forge extracts important statements from your documents - requirements, procedures, action items, and specifications. Instead of manually copying from PDFs or Word docs, Statement Forge does the heavy lifting.</p>

                <h4>What Can You Do With It?</h4>
                <ul>
                    <li><strong>Extract requirements from contracts</strong> - Get a clean list of all "shall" and "must" statements</li>
                    <li><strong>Digitize procedures and SOPs</strong> - Turn paper procedures into structured, numbered steps</li>
                    <li><strong>Build compliance checklists</strong> - Pull requirements from standards and categorize by priority</li>
                    <li><strong>Prepare Nimbus imports</strong> - Export directly to CSV format that Nimbus accepts</li>
                </ul>

                <h4>Supported File Types</h4>
                <p><strong>PDF</strong> (text-based), <strong>Word (.docx)</strong>, <strong>Text (.txt)</strong>, and <strong>Markdown (.md)</strong></p>
            </div>

            <div class="sf-help-tab-content" id="sf-help-howto">
                <h4>Basic Workflow</h4>
                <ol>
                    <li><strong>Load Your Document</strong> - Click Open and select your file, or use the current document</li>
                    <li><strong>Choose Document Type</strong> - Procedures or Work Instruction (affects extraction patterns)</li>
                    <li><strong>Click Extract</strong> - The engine analyzes and populates the table</li>
                    <li><strong>Review and Edit</strong> - Double-click rows to edit, merge, split, or delete</li>
                    <li><strong>Export</strong> - Download as CSV, Excel, JSON, or Word</li>
                </ol>

                <h4>Editing Statements</h4>
                <ul>
                    <li><strong>Edit</strong> - Double-click or press Enter</li>
                    <li><strong>Delete</strong> - Select rows and press Del</li>
                    <li><strong>Reorder</strong> - Drag handle or Alt+↑/↓</li>
                    <li><strong>Change level</strong> - Alt+←/→</li>
                    <li><strong>Merge</strong> - Select 2+ rows, click Merge</li>
                    <li><strong>Split</strong> - Select 1 row, click Split</li>
                </ul>
            </div>

            <div class="sf-help-tab-content" id="sf-help-shortcuts">
                <h4>Keyboard Shortcuts</h4>
                <div class="sf-shortcuts-grid">
                    <div class="sf-shortcut"><kbd>Ctrl+O</kbd><span>Open Document</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+S</kbd><span>Export</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+Z</kbd><span>Undo</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+Y</kbd><span>Redo</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+A</kbd><span>Select All</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+F</kbd><span>Search</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+M</kbd><span>Merge Selected</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+E</kbd><span>Expand All</span></div>
                    <div class="sf-shortcut"><kbd>Ctrl+Shift+E</kbd><span>Collapse All</span></div>
                    <div class="sf-shortcut"><kbd>↑ / ↓</kbd><span>Navigate Rows</span></div>
                    <div class="sf-shortcut"><kbd>Space</kbd><span>Toggle Select</span></div>
                    <div class="sf-shortcut"><kbd>Enter</kbd><span>Edit Selected</span></div>
                    <div class="sf-shortcut"><kbd>Delete</kbd><span>Delete Selected</span></div>
                    <div class="sf-shortcut"><kbd>Insert</kbd><span>Add Statement</span></div>
                    <div class="sf-shortcut"><kbd>Alt+↑</kbd><span>Move Up</span></div>
                    <div class="sf-shortcut"><kbd>Alt+↓</kbd><span>Move Down</span></div>
                    <div class="sf-shortcut"><kbd>Alt+←</kbd><span>Outdent</span></div>
                    <div class="sf-shortcut"><kbd>Alt+→</kbd><span>Indent</span></div>
                    <div class="sf-shortcut"><kbd>F1</kbd><span>Help</span></div>
                    <div class="sf-shortcut"><kbd>Escape</kbd><span>Close / Cancel</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- v3.0.41: Role Mapping Results Container (separate modal) -->
<div class="modal modal-md" id="modal-sf-role-mapping" role="dialog" aria-modal="true">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i data-lucide="users"></i> Role Mapping</h3>
            <button class="btn btn-ghost modal-close"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body">
            <div id="sf-role-mapping-container" class="sf-role-mapping-container">
                <!-- Populated dynamically by displayRoleMapping() -->
            </div>
        </div>
    </div>
</div>

<!-- v2.9.9: Score Breakdown Modal (#47 - Actionable Quality Score) -->
<div class="modal modal-md" id="modal-score-breakdown" role="dialog" aria-modal="true" aria-labelledby="modal-score-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-score-title"><i data-lucide="activity"></i> Document Health Score</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body" style="padding: var(--space-6);">
            <!-- Score Overview -->
            <div class="score-breakdown-header" style="text-align: center; margin-bottom: var(--space-6);">
                <div class="score-large" id="score-breakdown-value" style="font-size: 64px; font-weight: 700; line-height: 1;">--</div>
                <div class="score-grade-large" id="score-breakdown-grade" style="font-size: 24px; font-weight: 600; margin-top: var(--space-2);">Grade: --</div>
            </div>
            
            <!-- Score Components -->
            <div class="score-breakdown-components" style="display: flex; flex-direction: column; gap: var(--space-4);">
                <div class="score-component" data-component="severity">
                    <div class="component-header" style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                        <span class="component-label" style="font-weight: 500;"><i data-lucide="alert-triangle" style="width:16px;height:16px;"></i> Issue Impact</span>
                        <span class="component-value" id="score-comp-severity">--/50</span>
                    </div>
                    <div class="component-bar" style="height: 8px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden;">
                        <div class="component-fill" id="score-bar-severity" style="height: 100%; background: var(--warning); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <p class="component-desc" style="font-size: var(--font-size-sm); color: var(--text-muted); margin-top: var(--space-1);">Based on issue severity (Critical issues have 4x impact)</p>
                </div>
                
                <div class="score-component" data-component="readability">
                    <div class="component-header" style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                        <span class="component-label" style="font-weight: 500;"><i data-lucide="book-open" style="width:16px;height:16px;"></i> Readability</span>
                        <span class="component-value" id="score-comp-readability">--/15</span>
                    </div>
                    <div class="component-bar" style="height: 8px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden;">
                        <div class="component-fill" id="score-bar-readability" style="height: 100%; background: var(--info); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <p class="component-desc" style="font-size: var(--font-size-sm); color: var(--text-muted); margin-top: var(--space-1);">FK Grade 10-16 is ideal for technical documents</p>
                </div>
                
                <div class="score-component" data-component="structure">
                    <div class="component-header" style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                        <span class="component-label" style="font-weight: 500;"><i data-lucide="layout" style="width:16px;height:16px;"></i> Structure</span>
                        <span class="component-value" id="score-comp-structure">--/20</span>
                    </div>
                    <div class="component-bar" style="height: 8px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden;">
                        <div class="component-fill" id="score-bar-structure" style="height: 100%; background: var(--success); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <p class="component-desc" style="font-size: var(--font-size-sm); color: var(--text-muted); margin-top: var(--space-1);">TOC, headings, and section organization</p>
                </div>
                
                <div class="score-component" data-component="completeness">
                    <div class="component-header" style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                        <span class="component-label" style="font-weight: 500;"><i data-lucide="check-square" style="width:16px;height:16px;"></i> Completeness</span>
                        <span class="component-value" id="score-comp-completeness">--/15</span>
                    </div>
                    <div class="component-bar" style="height: 8px; background: var(--bg-secondary); border-radius: var(--radius-full); overflow: hidden;">
                        <div class="component-fill" id="score-bar-completeness" style="height: 100%; background: var(--accent); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <p class="component-desc" style="font-size: var(--font-size-sm); color: var(--text-muted); margin-top: var(--space-1);">Tables, figures, and content depth</p>
                </div>
            </div>
            
            <!-- Improvement Suggestions -->
            <div class="score-improvements" style="margin-top: var(--space-6); padding-top: var(--space-4); border-top: 1px solid var(--border-default);">
                <h4 style="font-size: var(--font-size-base); margin-bottom: var(--space-3);"><i data-lucide="lightbulb" style="width:16px;height:16px;"></i> Top Improvements</h4>
                <ul class="improvement-list" id="score-improvements-list" style="list-style: none; padding: 0; display: flex; flex-direction: column; gap: var(--space-2);">
                    <!-- Dynamically populated -->
                </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" id="btn-score-breakdown-close">Got it</button>
        </div>
    </div>
</div>

<!-- v3.0.45: Keyboard Shortcuts Quick Reference Modal -->
<div class="modal modal-md" id="modal-shortcuts" role="dialog" aria-modal="true" aria-labelledby="shortcuts-title">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="shortcuts-title"><i data-lucide="keyboard"></i> Keyboard Shortcuts</h3>
            <button class="btn btn-ghost modal-close" aria-label="Close modal"><i data-lucide="x"></i></button>
        </div>
        <div class="modal-body shortcuts-body">
            <div class="shortcuts-grid">
                <div class="shortcuts-section">
                    <h4>File Operations</h4>
                    <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>O</kbd><span>Open file</span></div>
                    <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>R</kbd><span>Run review</span></div>
                    <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>E</kbd><span>Export results</span></div>
                </div>
                <div class="shortcuts-section">
                    <h4>Navigation</h4>
                    <div class="shortcut-item"><kbd>J</kbd><span>Next issue</span></div>
                    <div class="shortcut-item"><kbd>K</kbd><span>Previous issue</span></div>
                    <div class="shortcut-item"><kbd>Enter</kbd><span>Expand/collapse issue</span></div>
                    <div class="shortcut-item"><kbd>Space</kbd><span>Toggle selection</span></div>
                </div>
                <div class="shortcuts-section">
                    <h4>Selection</h4>
                    <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>A</kbd><span>Select all issues</span></div>
                    <div class="shortcut-item"><kbd>Esc</kbd><span>Deselect / Close modal</span></div>
                </div>
                <div class="shortcuts-section">
                    <h4>Interface</h4>
                    <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>B</kbd><span>Toggle sidebar</span></div>
                    <div class="shortcut-item"><kbd>F1</kbd><span>Open help</span></div>
                    <div class="shortcut-item"><kbd>?</kbd><span>This shortcuts panel</span></div>
                </div>
            </div>
            <div class="shortcuts-footer">
                <p class="text-muted">Tip: Focus on the issues list for J/K navigation</p>
            </div>
        </div>
    </div>
</div>

<!-- v3.0.110: Document Comparison Modal -->
<div class="modal modal-fullscreen" id="modal-doc-compare" role="dialog" aria-modal="true" aria-labelledby="modal-dc-title">
    <div class="modal-content dc-modal-content">
        <!-- Header -->
        <header class="dc-header">
            <div class="dc-header-info">
                <h3 id="modal-dc-title">
                    <i data-lucide="git-compare"></i>
                    <span>Document Comparison</span>
                </h3>
                <span class="dc-doc-title">Select scans to compare</span>
            </div>
            <div class="dc-scan-selectors">
                <span>Compare:</span>
                <select class="dc-scan-select" id="dc-old-scan">
                    <option value="">Select older scan...</option>
                </select>
                <span class="dc-scan-arrow">&rarr;</span>
                <select class="dc-scan-select" id="dc-new-scan">
                    <option value="">Select newer scan...</option>
                </select>
                <button class="btn btn-primary btn-sm" id="dc-btn-compare">Compare</button>
            </div>
            <button class="btn btn-ghost btn-icon" id="dc-btn-close" title="Close (Esc)">
                <i data-lucide="x"></i>
            </button>
        </header>

        <!-- Navigation Bar -->
        <div class="dc-navigation">
            <div class="dc-nav-buttons">
                <button class="dc-nav-btn" id="dc-btn-first" title="First change (Home)" disabled>
                    <i data-lucide="chevrons-up"></i>
                </button>
                <button class="dc-nav-btn" id="dc-btn-prev" title="Previous change (K)" disabled>
                    <i data-lucide="chevron-up"></i>
                </button>
                <span class="dc-nav-counter">
                    <strong id="dc-change-current">0</strong> / <span id="dc-change-total">0</span>
                </span>
                <button class="dc-nav-btn" id="dc-btn-next" title="Next change (J)" disabled>
                    <i data-lucide="chevron-down"></i>
                </button>
                <button class="dc-nav-btn" id="dc-btn-last" title="Last change (End)" disabled>
                    <i data-lucide="chevrons-down"></i>
                </button>
            </div>

            <div class="dc-filter-dropdown">
                <select class="dc-scan-select" id="dc-filter">
                    <option value="all">All Changes</option>
                    <option value="additions">Additions Only</option>
                    <option value="deletions">Deletions Only</option>
                    <option value="modifications">Modifications Only</option>
                </select>
            </div>

            <div class="dc-stats-summary" id="dc-stats">
                <span class="dc-stat dc-stat-added" title="Added">+<span id="dc-stat-added">0</span></span>
                <span class="dc-stat dc-stat-deleted" title="Deleted">&minus;<span id="dc-stat-deleted">0</span></span>
                <span class="dc-stat dc-stat-modified" title="Modified">~<span id="dc-stat-modified">0</span></span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="dc-body">
            <!-- Minimap -->
            <div class="dc-minimap" id="dc-minimap"></div>

            <!-- Diff Panels -->
            <div class="dc-diff-panels">
                <div class="dc-panel dc-panel-old">
                    <div class="dc-panel-header">
                        <i data-lucide="clock"></i>
                        <span id="dc-old-label">Original</span>
                    </div>
                    <div class="dc-panel-content" id="dc-content-old"></div>
                </div>

                <div class="dc-panel dc-panel-new">
                    <div class="dc-panel-header">
                        <i data-lucide="clock"></i>
                        <span id="dc-new-label">Current</span>
                    </div>
                    <div class="dc-panel-content" id="dc-content-new"></div>
                </div>
            </div>

            <!-- Issues Panel -->
            <aside class="dc-issues-panel" id="dc-issues-panel">
                <div class="dc-issues-header">
                    <h4>Issues</h4>
                    <button class="btn btn-ghost btn-xs" id="dc-btn-toggle-issues" title="Toggle panel (I)">
                        <i data-lucide="panel-right-close"></i>
                    </button>
                </div>
                <div class="dc-issues-content">
                    <div class="dc-score-comparison">
                        <div class="dc-score dc-score-old">
                            <div class="dc-score-value" id="dc-score-old">--</div>
                            <div class="dc-score-label">Before</div>
                        </div>
                        <div class="dc-score-change" id="dc-score-change">--</div>
                        <div class="dc-score dc-score-new">
                            <div class="dc-score-value" id="dc-score-new">--</div>
                            <div class="dc-score-label">After</div>
                        </div>
                    </div>

                    <div class="dc-issue-stat fixed">
                        <i data-lucide="check-circle"></i>
                        <span>Fixed:</span>
                        <strong id="dc-issues-fixed">0</strong>
                    </div>
                    <div class="dc-issue-stat new">
                        <i data-lucide="alert-circle"></i>
                        <span>New:</span>
                        <strong id="dc-issues-new">0</strong>
                    </div>
                </div>
            </aside>
        </div>
    </div>
</div>

<!-- Hyperlink Validator Modal (v1.0.0) -->
<div class="modal modal-fullscreen" id="modal-hyperlink-validator" role="dialog" aria-modal="true" aria-labelledby="modal-hv-title">
    <div class="modal-content hv-modal-content">

        <!-- Header -->
        <header class="hv-header">
            <div class="hv-header-info">
                <h3 id="modal-hv-title">
                    <i data-lucide="link-2"></i>
                    <span>Hyperlink Validator</span>
                </h3>
                <span class="hv-subtitle">Standalone URL validation tool</span>
            </div>

            <div class="hv-mode-selector">
                <label>Mode:</label>
                <select id="hv-mode">
                    <option value="offline">Offline (Format Only)</option>
                    <option value="validator" selected>Full Validation (Windows Auth)</option>
                </select>
                <label style="margin-left: 1rem;">Depth:</label>
                <select id="hv-scan-depth">
                    <option value="quick">Quick (Format)</option>
                    <option value="standard" selected>Standard</option>
                    <option value="thorough">Thorough (DNS+SSL)</option>
                </select>
            </div>

            <button class="btn btn-ghost btn-icon" id="hv-btn-close" title="Close (Esc)">
                <i data-lucide="x"></i>
            </button>
        </header>

        <!-- Input Section -->
        <div class="hv-input-section">
            <div class="hv-input-tabs">
                <button class="hv-tab active" data-tab="upload">Upload File</button>
                <button class="hv-tab" data-tab="paste">Paste URLs</button>
            </div>

            <div class="hv-tab-content" id="hv-tab-upload">
                <div class="hv-dropzone" id="hv-dropzone">
                    <i data-lucide="upload-cloud"></i>
                    <p>Drop a file here (TXT, CSV, DOCX, or Excel)</p>
                    <input type="file" id="hv-file-input" accept=".txt,.csv,.json,.docx,.xlsx,.xls" hidden>
                    <button class="btn btn-secondary">Browse Files</button>
                    <span class="hv-dropzone-file-types">Supports: .txt, .csv, .docx, .xlsx, .xls</span>
                </div>
            </div>

            <div class="hv-tab-content" id="hv-tab-paste" style="display:none">
                <textarea id="hv-url-input" placeholder="Paste URLs here (one per line)..."></textarea>
                <div class="hv-input-actions">
                    <span class="hv-url-count">0 URLs detected</span>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary btn-sm" id="hv-btn-clear">Clear</button>
                        <button class="btn btn-primary" id="hv-btn-validate">
                            <i data-lucide="play"></i> Validate
                        </button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Settings Panel (collapsible) -->
        <div class="hv-settings collapsed" id="hv-settings">
            <button class="hv-settings-toggle" id="hv-settings-toggle">
                <i data-lucide="settings"></i> Advanced Settings
                <i data-lucide="chevron-down"></i>
            </button>
            <div class="hv-settings-content">
                <div class="hv-settings-row">
                    <label>Timeout (seconds): <input type="number" id="hv-timeout" value="10" min="1" max="60"></label>
                    <label>Max Retries: <input type="number" id="hv-retries" value="3" min="0" max="10"></label>
                    <label><input type="checkbox" id="hv-windows-auth" checked> Use Windows SSO</label>
                    <label><input type="checkbox" id="hv-follow-redirects" checked> Follow Redirects</label>
                </div>

                <!-- Exclusions Section -->
                <div class="hv-exclusions-section">
                    <div class="hv-exclusions-header">
                        <strong>URL Exclusions</strong> <span class="hv-exclusion-count">(0)</span>
                        <button class="btn btn-secondary btn-xs" id="hv-btn-add-exclusion">+ Add Rule</button>
                    </div>
                    <p class="hv-exclusions-help">Excluded URLs will be treated as OK (green) in reports.</p>
                    <div class="hv-exclusions-list" id="hv-exclusions-list">
                        <!-- Exclusion rules will be dynamically added here -->
                    </div>
                </div>

                <!-- Add Exclusion Modal -->
                <div class="hv-exclusion-form" id="hv-exclusion-form" style="display:none;">
                    <input type="text" id="hv-exclusion-pattern" placeholder="Pattern (e.g., twitter.com, *.internal.*)">
                    <select id="hv-exclusion-type">
                        <option value="contains">Contains</option>
                        <option value="exact">Exact Match</option>
                        <option value="prefix">Starts With</option>
                        <option value="suffix">Ends With</option>
                        <option value="regex">Regex</option>
                    </select>
                    <input type="text" id="hv-exclusion-reason" placeholder="Reason (optional)">
                    <label><input type="checkbox" id="hv-exclusion-valid" checked> Treat as Valid (show green)</label>
                    <div class="hv-exclusion-form-actions">
                        <button class="btn btn-secondary btn-sm" id="hv-btn-cancel-exclusion">Cancel</button>
                        <button class="btn btn-primary btn-sm" id="hv-btn-save-exclusion">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Section - 3D Animated -->
        <div class="hv-progress" id="hv-progress" style="display:none">
            <!-- Glowing orb accents -->
            <div class="hv-progress-orb hv-progress-orb-1"></div>
            <div class="hv-progress-orb hv-progress-orb-2"></div>
            <div class="hv-progress-orb hv-progress-orb-3"></div>

            <!-- Progress bar with particles -->
            <div class="hv-progress-bar">
                <div class="hv-progress-fill" id="hv-progress-fill">
                    <div class="hv-progress-shine"></div>
                </div>
                <!-- Floating particles -->
                <div class="hv-progress-particles">
                    <div class="hv-progress-particle orb" style="left: 10%; animation-delay: 0s;"></div>
                    <div class="hv-progress-particle orb" style="left: 25%; animation-delay: 0.5s;"></div>
                    <div class="hv-progress-particle orb" style="left: 40%; animation-delay: 1s;"></div>
                    <div class="hv-progress-particle orb" style="left: 55%; animation-delay: 1.5s;"></div>
                    <div class="hv-progress-particle orb" style="left: 70%; animation-delay: 2s;"></div>
                    <div class="hv-progress-particle orb" style="left: 85%; animation-delay: 0.3s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 15%; animation-delay: 0.2s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 35%; animation-delay: 0.7s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 50%; animation-delay: 1.2s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 65%; animation-delay: 0.4s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 80%; animation-delay: 0.9s;"></div>
                    <div class="hv-progress-particle sparkle" style="left: 95%; animation-delay: 1.6s;"></div>
                </div>
                <!-- Horizontal streaks -->
                <div class="hv-progress-streak" style="top: 20%; animation-delay: 0s;"></div>
                <div class="hv-progress-streak" style="top: 50%; animation-delay: 1s;"></div>
                <div class="hv-progress-streak" style="top: 80%; animation-delay: 2s;"></div>
            </div>

            <div class="hv-progress-info">
                <span id="hv-progress-text">Validating...</span>
                <span id="hv-progress-stats">0 / 0 URLs</span>
                <span id="hv-progress-eta"></span>
            </div>
            <button class="btn btn-secondary btn-sm" id="hv-btn-cancel">Cancel</button>
        </div>

        <!-- Results Section -->
        <div class="hv-results" id="hv-results">
            <!-- Enhanced Visual Stats Cards -->
            <div class="hv-stats-grid" id="hv-stats-grid">
                <!-- Stat cards will be rendered by HyperlinkVisualization.createStatCards() -->
                <div class="hv-stat-card stat-working">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="check-circle"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-working">0</div>
                    <div class="hv-stat-card-label">Working</div>
                </div>
                <div class="hv-stat-card stat-broken">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="x-circle"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-broken">0</div>
                    <div class="hv-stat-card-label">Broken</div>
                </div>
                <div class="hv-stat-card stat-redirect">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="arrow-right-circle"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-redirect">0</div>
                    <div class="hv-stat-card-label">Redirects</div>
                </div>
                <div class="hv-stat-card stat-timeout">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="clock"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-timeout">0</div>
                    <div class="hv-stat-card-label">Timeout</div>
                </div>
                <div class="hv-stat-card stat-blocked">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="shield-off"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-blocked">0</div>
                    <div class="hv-stat-card-label">Blocked</div>
                </div>
                <div class="hv-stat-card stat-unknown">
                    <div class="hv-stat-card-icon">
                        <i data-lucide="help-circle"></i>
                    </div>
                    <div class="hv-stat-card-value" id="hv-count-unknown">0</div>
                    <div class="hv-stat-card-label">Other</div>
                </div>
            </div>

            <!-- Visual Analytics Charts -->
            <div class="hv-chart-section" id="hv-chart-section" style="display: none;">
                <div class="hv-chart-card">
                    <div class="hv-chart-title">
                        <i data-lucide="pie-chart"></i>
                        Status Distribution
                    </div>
                    <div id="hv-donut-chart"></div>
                </div>
                <div class="hv-chart-card">
                    <div id="hv-response-histogram"></div>
                </div>
            </div>

            <!-- 3D Domain Health Carousel (v3.0.125) -->
            <div id="hv-domain-carousel-section" style="display: none; margin: 0 1rem 1rem;">
                <div id="hv-domain-carousel"></div>
            </div>

            <!-- Domain Health Heatmap (alternate view) -->
            <div class="hv-chart-card" id="hv-domain-heatmap-section" style="display: none; margin: 0 1rem 1rem;">
                <div id="hv-domain-heatmap"></div>
            </div>

            <!-- Headless Browser Rescan Button (for blocked URLs) -->
            <div id="hv-rescan-section" style="display: none; padding: 0 1rem 1rem;">
                <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px;">
                    <i data-lucide="chrome" style="color: #8b5cf6;"></i>
                    <div style="flex: 1;">
                        <strong style="color: var(--text-primary);">Bot-Protected Sites Detected</strong>
                        <p style="margin: 0.25rem 0 0; font-size: 0.875rem; color: var(--text-secondary);">
                            <span id="hv-blocked-count">0</span> URLs were blocked by bot protection. Use headless browser to validate.
                        </p>
                    </div>
                    <button class="hv-rescan-btn" id="hv-btn-rescan">
                        <i data-lucide="refresh-cw"></i>
                        Rescan with Browser
                    </button>
                </div>
            </div>

            <!-- Extended Metrics (Thorough Mode) -->
            <div class="hv-extended-metrics" id="hv-extended-metrics" style="display:none;">
                <div class="hv-metric-group">
                    <strong>Thorough Scan Results:</strong>
                    <span><span id="hv-count-ssl-warnings">0</span> SSL Warnings</span>
                    <span><span id="hv-count-soft-404">0</span> Soft 404s</span>
                    <span><span id="hv-count-suspicious">0</span> Suspicious</span>
                </div>
                <div class="hv-metric-group">
                    <strong>Response Times:</strong>
                    <span>Avg: <span id="hv-avg-time">0</span>ms</span>
                    <span>Min: <span id="hv-min-time">0</span>ms</span>
                    <span>Max: <span id="hv-max-time">0</span>ms</span>
                </div>
            </div>

            <!-- Filter & Export -->
            <div class="hv-toolbar">
                <div class="hv-filter">
                    <select id="hv-filter-status">
                        <option value="all">All Statuses</option>
                        <option value="working">Working Only</option>
                        <option value="broken">Broken Only</option>
                        <option value="issues">Issues Only</option>
                    </select>
                    <input type="text" id="hv-filter-search" placeholder="Search URLs...">
                </div>
                <div class="hv-export-btns">
                    <button class="btn btn-secondary btn-sm" id="hv-btn-export-csv">
                        <i data-lucide="file-text"></i> CSV
                    </button>
                    <button class="btn btn-secondary btn-sm" id="hv-btn-export-json">
                        <i data-lucide="braces"></i> JSON
                    </button>
                    <button class="btn btn-secondary btn-sm" id="hv-btn-export-html">
                        <i data-lucide="file-code"></i> HTML Report
                    </button>
                    <span class="hv-export-divider"></span>
                    <button class="btn btn-primary btn-sm" id="hv-btn-export-highlighted" title="Export original file with broken links highlighted" disabled>
                        <i data-lucide="highlighter"></i> Export Highlighted
                    </button>
                    <span class="hv-export-divider"></span>
                    <button class="btn btn-secondary btn-sm" id="hv-btn-show-history" title="Show validation history">
                        <i data-lucide="history"></i> History
                    </button>
                </div>
            </div>

            <!-- Results Table -->
            <div class="hv-table-wrapper">
                <table class="hv-table" id="hv-results-table">
                    <thead>
                        <tr>
                            <th class="hv-col-status" data-sort="status">Status</th>
                            <th class="hv-col-url" data-sort="url">URL</th>
                            <th class="hv-col-code" data-sort="status_code">Code</th>
                            <th class="hv-col-message">Message</th>
                            <th class="hv-col-time" data-sort="response_time_ms">Time</th>
                            <th class="hv-col-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="hv-results-body"></tbody>
                </table>
            </div>
        </div>

        <!-- History Panel (sidebar) -->
        <aside class="hv-history-panel" id="hv-history-panel">
            <div class="hv-history-header">
                <h4>Validation History</h4>
                <button class="btn btn-ghost btn-xs" id="hv-btn-toggle-history">
                    <i data-lucide="panel-right-close"></i>
                </button>
            </div>
            <div class="hv-history-list" id="hv-history-list"></div>
        </aside>

    </div>
</div>

<!-- TWR Module Files (v3.0.46) - Load before app.js for modular architecture -->
<script src="/static/js/ui/storage.js"></script>
<script src="/static/js/utils/dom.js"></script>
<script src="/static/js/ui/state.js"></script>
<script src="/static/js/api/client.js"></script>
<script src="/static/js/ui/modals.js"></script>
<script src="/static/js/ui/events.js"></script>
<script src="/static/js/ui/renderers.js"></script>
<script src="/static/js/features/roles.js"></script>
<script src="/static/js/features/triage.js"></script>
<script src="/static/js/features/families.js"></script>

<!-- Help system -->
<script src="/static/js/help-docs.js"></script>
<script src="/static/js/help-content.js"></script>

<!-- Main application -->
<script src="/static/js/app.js"></script>
<!-- Fix modules (v3.0.52 - v3.0.68) -->
<script src="/static/js/update-functions.js"></script>
<script src="/static/js/button-fixes.js"></script>
<script src="/static/js/run-state-fixes.js"></script>
<script src="/static/js/history-fixes.js"></script>
<script src="/static/js/roles-dictionary-fix.js"></script>
<script src="/static/js/roles-tabs-fix.js"></script>
<script src="/static/js/roles-export-fix.js"></script>

<!-- Fix Assistant v2 Modules (v3.0.97) -->
<script src="/static/js/features/document-viewer.js"></script>
<script src="/static/js/features/minimap.js"></script>
<script src="/static/js/features/fix-assistant-state.js"></script>
<script src="/static/js/features/learner-client.js"></script>
<script src="/static/js/features/a11y-manager.js"></script>
<script src="/static/js/features/sound-effects.js"></script>
<script src="/static/js/features/preview-modes.js"></script>
<script src="/static/js/features/report-client.js"></script>

<!-- Diagnostic Console Capture (v3.0.114) - Load early to capture all logs -->
<script src="/static/js/features/console-capture.js"></script>

<!-- Document Comparison Module (v3.0.110) -->
<script src="/static/js/features/doc-compare-state.js"></script>
<script src="/static/js/features/doc-compare.js"></script>
<!-- Portfolio Module (v3.0.114) -->
<script src="/static/js/features/portfolio.js"></script>
<!-- Hyperlink Validator Module (v3.0.125) -->
<script src="/static/js/features/hyperlink-validator-state.js"></script>
<script src="/static/js/features/hyperlink-validator.js"></script>
<script src="/static/js/features/hyperlink-visualizations.js"></script>
<!-- Link History Module (v1.0.0) -->
<script src="/static/js/features/link-history.js"></script>
</body>
</html>
